const translations = {
  en: {
    languageQuestionFirst: 'Hey, what language can we speak?',
    welcomeQuestion: 'Welcome, what can I call you?',
    yourName: 'Your name',
    continue: 'Continue',
    welcomeBack: 'Welcome back!',
    enterPin: 'Enter your 4-digit PIN',
    login: 'Login',
    newUser: 'New user!',
    addonNameQuestion: 'And what should I be called?',
    addonNameHelp: 'This will be the addon name in your player',
    tmdbQuestion: "I'll need your TMDB API Key",
    tmdbKeyPlaceholder: 'TMDB API Key',
    getTmdbKeyText: 'Get it',
    here: 'HERE',
    createPin: 'Create a 4-digit PIN',
    pinHelp: 'Use it to access your account',
    startButton: "Let's create your lists",
    mainTitleTemplate: 'Alright {{username}}, what did you like?',
    yourLists: 'These are your lists',
    createList: 'Create new list',
    listName: 'List name',
    listTypeTemplate: "{{username}}'s library",
    create: 'Create',
    searchPlaceholder: 'Search movies/series...',
    importPin: 'Add list by PIN',
    copyUrl: 'Copy install URL',
    install: 'Install in your player',
    share: 'Share',
    delete: 'Delete',
    selectListModal: 'Which list do you want to add this to?',
    add: 'Add',
    cancel: 'Cancel',
    back: 'Back',
    importPinTitle: 'Enter the 6-digit PIN',
    import: 'Import',
    sharePinTitle: 'List PIN',
    sharePinText: 'Share this PIN so others can import the list',
    copyPin: 'Copy PIN',
    close: 'Close',
    deleteItem: 'Delete',
    rate: 'Rate',
    rateTitle: 'Rate this item',
    reviewPlaceholder: 'Write a review (optional)...',
    submit: 'Submit',
    ratingsTitle: 'Ratings',
    viewRatings: 'Ratings',
    friends: 'Friends',
    friendUsername: 'Username',
    addFriend: 'Add friend',
    removeFriend: 'Remove',
    friendLists: 'Lists',
    friendRatings: 'Recent ratings',
    noFriends: 'No friends yet',
    noLists: 'No lists created yet',
    noItems: 'No items in this list'
  },
  es: {
    languageQuestionFirst: 'Ey, Â¿en quÃ© idioma podemos hablar?',
    welcomeQuestion: 'Bienvenido, Â¿cÃ³mo puedo llamarte?',
    yourName: 'Tu nombre',
    continue: 'Continuar',
    welcomeBack: 'Â¡Bienvenido de nuevo!',
    enterPin: 'Introduce tu PIN de 4 dÃ­gitos',
    login: 'Iniciar sesiÃ³n',
    newUser: 'Â¡Nuevo usuario!',
    addonNameQuestion: 'Â¿Y cÃ³mo me llamo yo?',
    addonNameHelp: 'Este serÃ¡ el nombre del addon en tu reproductor',
    tmdbQuestion: 'Voy a necesitar tu clave API de TMDB',
    tmdbKeyPlaceholder: 'API Key de TMDB',
    getTmdbKeyText: 'Esto lo consigues',
    here: 'AQUÃ',
    createPin: 'Crea un PIN de 4 dÃ­gitos',
    pinHelp: 'Ãsalo para acceder a tu cuenta',
    startButton: 'Pasemos a crear tus listas',
    mainTitleTemplate: 'De acuerdo {{username}}, Â¿quÃ© fue eso que te gustÃ³?',
    yourLists: 'Estas son tus listas',
    createList: 'Crear nueva lista',
    listName: 'Nombre de la lista',
    listTypeTemplate: 'LibrerÃ­a de {{username}}',
    create: 'Crear',
    searchPlaceholder: 'Buscar pelÃ­culas/series...',
    importPin: 'AÃ±adir lista por PIN',
    copyUrl: 'Copiar URL de instalaciÃ³n',
    install: 'Instalar en tu reproductor',
    share: 'Compartir',
    delete: 'Eliminar',
    selectListModal: 'Â¿A quÃ© lista quieres agregar esto?',
    add: 'Agregar',
    cancel: 'Cancelar',
    back: 'Volver',
    importPinTitle: 'Introduce el PIN de 6 dÃ­gitos',
    import: 'Importar',
    sharePinTitle: 'PIN de la lista',
    sharePinText: 'Comparte este PIN para que otros puedan importar la lista',
    copyPin: 'Copiar PIN',
    close: 'Cerrar',
    deleteItem: 'Eliminar',
    rate: 'Calificar',
    rateTitle: 'Calificar este elemento',
    reviewPlaceholder: 'Escribe una reseÃ±a (opcional)...',
    submit: 'Enviar',
    ratingsTitle: 'Calificaciones',
    viewRatings: 'Calificaciones',
    friends: 'Amigos',
    friendUsername: 'Nombre de usuario',
    addFriend: 'AÃ±adir amigo',
    removeFriend: 'Eliminar',
    friendLists: 'Listas',
    friendRatings: 'Calificaciones recientes',
    noFriends: 'AÃºn no tienes amigos',
    noLists: 'No hay listas creadas aÃºn',
    noItems: 'No hay elementos en esta lista'
  },
  fr: {
    languageQuestionFirst: 'HÃ©, quelle langue pouvons-nous parler?',
    welcomeQuestion: 'Bienvenue, comment puis-je t\'appeler?',
    yourName: 'Ton nom',
    continue: 'Continuer',
    welcomeBack: 'Bon retour!',
    enterPin: 'Entre ton PIN Ã  4 chiffres',
    login: 'Connexion',
    newUser: 'Nouvel utilisateur!',
    addonNameQuestion: 'Et comment je m\'appelle?',
    addonNameHelp: 'Ce sera le nom de l\'addon dans ton lecteur',
    tmdbQuestion: 'J\'aurai besoin de ta clÃ© API TMDB',
    tmdbKeyPlaceholder: 'ClÃ© API TMDB',
    getTmdbKeyText: 'Obtiens-la',
    here: 'ICI',
    createPin: 'CrÃ©e un PIN Ã  4 chiffres',
    pinHelp: 'Utilise-le pour accÃ©der Ã  ton compte',
    startButton: 'CrÃ©ons tes listes',
    mainTitleTemplate: "D'accord {{username}}, qu'as-tu aimÃ©?",
    yourLists: 'Voici tes listes',
    createList: 'CrÃ©er une nouvelle liste',
    listName: 'Nom de la liste',
    listTypeTemplate: 'BibliothÃ¨que de {{username}}',
    create: 'CrÃ©er',
    searchPlaceholder: 'Rechercher films/sÃ©ries...',
    importPin: 'Ajouter une liste par PIN',
    copyUrl: 'Copier l\'URL d\'installation',
    install: 'Installer dans ton lecteur',
    share: 'Partager',
    delete: 'Supprimer',
    selectListModal: 'Ã quelle liste veux-tu ajouter ceci?',
    add: 'Ajouter',
    cancel: 'Annuler',
    back: 'Retour',
    importPinTitle: 'Entre le PIN Ã  6 chiffres',
    import: 'Importer',
    sharePinTitle: 'PIN de la liste',
    sharePinText: 'Partage ce PIN pour que d\'autres puissent importer la liste',
    copyPin: 'Copier le PIN',
    close: 'Fermer',
    deleteItem: 'Supprimer',
    rate: 'Noter',
    rateTitle: 'Noter cet Ã©lÃ©ment',
    reviewPlaceholder: 'Ãcris un avis (optionnel)...',
    submit: 'Envoyer',
    ratingsTitle: 'Notes',
    viewRatings: 'Notes',
    friends: 'Amis',
    friendUsername: 'Nom d\'utilisateur',
    addFriend: 'Ajouter un ami',
    removeFriend: 'Supprimer',
    friendLists: 'Listes',
    friendRatings: 'Notes rÃ©centes',
    noFriends: 'Pas encore d\'amis',
    noLists: 'Aucune liste crÃ©Ã©e',
    noItems: 'Aucun Ã©lÃ©ment dans cette liste'
  },
  de: {
    languageQuestionFirst: 'Hey, welche Sprache kÃ¶nnen wir sprechen?',
    welcomeQuestion: 'Willkommen, wie kann ich dich nennen?',
    yourName: 'Dein Name',
    continue: 'Weiter',
    welcomeBack: 'Willkommen zurÃ¼ck!',
    enterPin: 'Gib deine 4-stellige PIN ein',
    login: 'Anmelden',
    newUser: 'Neuer Benutzer!',
    addonNameQuestion: 'Und wie soll ich heiÃen?',
    addonNameHelp: 'Dies wird der Addon-Name in deinem Player sein',
    tmdbQuestion: 'Ich brauche deinen TMDB API-SchlÃ¼ssel',
    tmdbKeyPlaceholder: 'TMDB API-SchlÃ¼ssel',
    getTmdbKeyText: 'Hol ihn dir',
    here: 'HIER',
    createPin: 'Erstelle eine 4-stellige PIN',
    pinHelp: 'Verwende sie fÃ¼r den Zugriff auf dein Konto',
    startButton: 'Lass uns deine Listen erstellen',
    mainTitleTemplate: 'Ok {{username}}, was hat dir gefallen?',
    yourLists: 'Das sind deine Listen',
    createList: 'Neue Liste erstellen',
    listName: 'Listenname',
    listTypeTemplate: '{{username}}s Bibliothek',
    create: 'Erstellen',
    searchPlaceholder: 'Filme/Serien suchen...',
    importPin: 'Liste per PIN hinzufÃ¼gen',
    copyUrl: 'Installations-URL kopieren',
    install: 'In deinem Player installieren',
    share: 'Teilen',
    delete: 'LÃ¶schen',
    selectListModal: 'Zu welcher Liste mÃ¶chtest du dies hinzufÃ¼gen?',
    add: 'HinzufÃ¼gen',
    cancel: 'Abbrechen',
    back: 'ZurÃ¼ck',
    importPinTitle: 'Gib die 6-stellige PIN ein',
    import: 'Importieren',
    sharePinTitle: 'Listen-PIN',
    sharePinText: 'Teile diese PIN, damit andere die Liste importieren kÃ¶nnen',
    copyPin: 'PIN kopieren',
    close: 'SchlieÃen',
    deleteItem: 'LÃ¶schen',
    rate: 'Bewerten',
    rateTitle: 'Dieses Element bewerten',
    reviewPlaceholder: 'Schreibe eine Bewertung (optional)...',
    submit: 'Senden',
    ratingsTitle: 'Bewertungen',
    viewRatings: 'Bewertungen',
    friends: 'Freunde',
    friendUsername: 'Benutzername',
    addFriend: 'Freund hinzufÃ¼gen',
    removeFriend: 'Entfernen',
    friendLists: 'Listen',
    friendRatings: 'Aktuelle Bewertungen',
    noFriends: 'Noch keine Freunde',
    noLists: 'Noch keine Listen erstellt',
    noItems: 'Keine Elemente in dieser Liste'
  },
  it: {
    languageQuestionFirst: 'Ehi, che lingua possiamo parlare?',
    welcomeQuestion: 'Benvenuto, come posso chiamarti?',
    yourName: 'Il tuo nome',
    continue: 'Continua',
    welcomeBack: 'Bentornato!',
    enterPin: 'Inserisci il tuo PIN a 4 cifre',
    login: 'Accedi',
    newUser: 'Nuovo utente!',
    addonNameQuestion: 'E come mi chiamo io?',
    addonNameHelp: 'Questo sarÃ  il nome dell\'addon nel tuo lettore',
    tmdbQuestion: 'AvrÃ² bisogno della tua chiave API TMDB',
    tmdbKeyPlaceholder: 'Chiave API TMDB',
    getTmdbKeyText: 'Ottienila',
    here: 'QUI',
    createPin: 'Crea un PIN a 4 cifre',
    pinHelp: 'Usalo per accedere al tuo account',
    startButton: 'Creiamo le tue liste',
    mainTitleTemplate: 'Va bene {{username}}, cosa ti Ã¨ piaciuto?',
    yourLists: 'Queste sono le tue liste',
    createList: 'Crea nuova lista',
    listName: 'Nome della lista',
    listTypeTemplate: 'Biblioteca di {{username}}',
    create: 'Crea',
    searchPlaceholder: 'Cerca film/serie...',
    importPin: 'Aggiungi lista con PIN',
    copyUrl: 'Copia URL di installazione',
    install: 'Installa nel tuo lettore',
    share: 'Condividi',
    delete: 'Elimina',
    selectListModal: 'A quale lista vuoi aggiungere questo?',
    add: 'Aggiungi',
    cancel: 'Annulla',
    back: 'Indietro',
    importPinTitle: 'Inserisci il PIN a 6 cifre',
    import: 'Importa',
    sharePinTitle: 'PIN della lista',
    sharePinText: 'Condividi questo PIN affinchÃ© altri possano importare la lista',
    copyPin: 'Copia PIN',
    close: 'Chiudi',
    deleteItem: 'Elimina',
    rate: 'Vota',
    rateTitle: 'Vota questo elemento',
    reviewPlaceholder: 'Scrivi una recensione (opzionale)...',
    submit: 'Invia',
    ratingsTitle: 'Valutazioni',
    viewRatings: 'Valutazioni',
    friends: 'Amici',
    friendUsername: 'Nome utente',
    addFriend: 'Aggiungi amico',
    removeFriend: 'Rimuovi',
    friendLists: 'Liste',
    friendRatings: 'Valutazioni recenti',
    noFriends: 'Nessun amico ancora',
    noLists: 'Nessuna lista creata',
    noItems: 'Nessun elemento in questa lista'
  },
  pt: {
    languageQuestionFirst: 'Ei, que idioma podemos falar?',
    welcomeQuestion: 'Bem-vindo, como posso te chamar?',
    yourName: 'Seu nome',
    continue: 'Continuar',
    welcomeBack: 'Bem-vindo de volta!',
    enterPin: 'Digite seu PIN de 4 dÃ­gitos',
    login: 'Entrar',
    newUser: 'Novo usuÃ¡rio!',
    addonNameQuestion: 'E como eu me chamo?',
    addonNameHelp: 'Este serÃ¡ o nome do addon no seu player',
    tmdbQuestion: 'Vou precisar da sua chave API TMDB',
    tmdbKeyPlaceholder: 'Chave API TMDB',
    getTmdbKeyText: 'Consiga',
    here: 'AQUI',
    createPin: 'Crie um PIN de 4 dÃ­gitos',
    pinHelp: 'Use-o para acessar sua conta',
    startButton: 'Vamos criar suas listas',
    mainTitleTemplate: 'Certo {{username}}, do que vocÃª gostou?',
    yourLists: 'Estas sÃ£o suas listas',
    createList: 'Criar nova lista',
    listName: 'Nome da lista',
    listTypeTemplate: 'Biblioteca de {{username}}',
    create: 'Criar',
    searchPlaceholder: 'Pesquisar filmes/sÃ©ries...',
    importPin: 'Adicionar lista por PIN',
    copyUrl: 'Copiar URL de instalaÃ§Ã£o',
    install: 'Instalar no seu player',
    share: 'Compartilhar',
    delete: 'Excluir',
    selectListModal: 'A qual lista vocÃª quer adicionar isto?',
    add: 'Adicionar',
    cancel: 'Cancelar',
    back: 'Voltar',
    importPinTitle: 'Digite o PIN de 6 dÃ­gitos',
    import: 'Importar',
    sharePinTitle: 'PIN da lista',
    sharePinText: 'Compartilhe este PIN para que outros possam importar a lista',
    copyPin: 'Copiar PIN',
    close: 'Fechar',
    deleteItem: 'Excluir',
    rate: 'Avaliar',
    rateTitle: 'Avaliar este item',
    reviewPlaceholder: 'Escreva uma avaliaÃ§Ã£o (opcional)...',
    submit: 'Enviar',
    ratingsTitle: 'AvaliaÃ§Ãµes',
    viewRatings: 'AvaliaÃ§Ãµes',
    friends: 'Amigos',
    friendUsername: 'Nome de usuÃ¡rio',
    addFriend: 'Adicionar amigo',
    removeFriend: 'Remover',
    friendLists: 'Listas',
    friendRatings: 'AvaliaÃ§Ãµes recentes',
    noFriends: 'Ainda sem amigos',
    noLists: 'Nenhuma lista criada',
    noItems: 'Nenhum item nesta lista'
  },
  ru: {
    languageQuestionFirst: 'Ð­Ð¹, Ð½Ð° ÐºÐ°ÐºÐ¾Ð¼ ÑÐ·ÑÐºÐµ Ð¼Ñ Ð¼Ð¾Ð¶ÐµÐ¼ Ð³Ð¾Ð²Ð¾ÑÐ¸ÑÑ?',
    welcomeQuestion: 'ÐÐ¾Ð±ÑÐ¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°ÑÑ, ÐºÐ°Ðº Ð¼Ð½Ðµ ÑÐµÐ±Ñ Ð½Ð°Ð·ÑÐ²Ð°ÑÑ?',
    yourName: 'Ð¢Ð²Ð¾Ðµ Ð¸Ð¼Ñ',
    continue: 'ÐÑÐ¾Ð´Ð¾Ð»Ð¶Ð¸ÑÑ',
    welcomeBack: 'Ð¡ Ð²Ð¾Ð·Ð²ÑÐ°ÑÐµÐ½Ð¸ÐµÐ¼!',
    enterPin: 'ÐÐ²ÐµÐ´Ð¸ ÑÐ²Ð¾Ð¹ 4-Ð·Ð½Ð°ÑÐ½ÑÐ¹ PIN',
    login: 'ÐÐ¾Ð¹ÑÐ¸',
    newUser: 'ÐÐ¾Ð²ÑÐ¹ Ð¿Ð¾Ð»ÑÐ·Ð¾Ð²Ð°ÑÐµÐ»Ñ!',
    addonNameQuestion: 'Ð ÐºÐ°Ðº Ð¼ÐµÐ½Ñ Ð·Ð¾Ð²ÑÑ?',
    addonNameHelp: 'Ð­ÑÐ¾ Ð±ÑÐ´ÐµÑ Ð¸Ð¼Ñ Ð°Ð´Ð´Ð¾Ð½Ð° Ð² ÑÐ²Ð¾ÐµÐ¼ Ð¿Ð»ÐµÐµÑÐµ',
    tmdbQuestion: 'ÐÐ½Ðµ Ð¿Ð¾Ð½Ð°Ð´Ð¾Ð±Ð¸ÑÑÑ ÑÐ²Ð¾Ð¹ API ÐºÐ»ÑÑ TMDB',
    tmdbKeyPlaceholder: 'API ÐºÐ»ÑÑ TMDB',
    getTmdbKeyText: 'ÐÐ¾Ð»ÑÑÐ¸ ÐµÐ³Ð¾',
    here: 'ÐÐÐÐ¡Ð¬',
    createPin: 'Ð¡Ð¾Ð·Ð´Ð°Ð¹ 4-Ð·Ð½Ð°ÑÐ½ÑÐ¹ PIN',
    pinHelp: 'ÐÑÐ¿Ð¾Ð»ÑÐ·ÑÐ¹ ÐµÐ³Ð¾ Ð´Ð»Ñ Ð´Ð¾ÑÑÑÐ¿Ð° Ðº Ð°ÐºÐºÐ°ÑÐ½ÑÑ',
    startButton: 'ÐÐ°Ð²Ð°Ð¹ ÑÐ¾Ð·Ð´Ð°Ð´Ð¸Ð¼ ÑÐ²Ð¾Ð¸ ÑÐ¿Ð¸ÑÐºÐ¸',
    mainTitleTemplate: 'Ð¥Ð¾ÑÐ¾ÑÐ¾ {{username}}, ÑÑÐ¾ ÑÐµÐ±Ðµ Ð¿Ð¾Ð½ÑÐ°Ð²Ð¸Ð»Ð¾ÑÑ?',
    yourLists: 'ÐÐ¾Ñ ÑÐ²Ð¾Ð¸ ÑÐ¿Ð¸ÑÐºÐ¸',
    createList: 'Ð¡Ð¾Ð·Ð´Ð°ÑÑ Ð½Ð¾Ð²ÑÐ¹ ÑÐ¿Ð¸ÑÐ¾Ðº',
    listName: 'ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ ÑÐ¿Ð¸ÑÐºÐ°',
    listTypeTemplate: 'ÐÐ¸Ð±Ð»Ð¸Ð¾ÑÐµÐºÐ° {{username}}',
    create: 'Ð¡Ð¾Ð·Ð´Ð°ÑÑ',
    searchPlaceholder: 'ÐÑÐºÐ°ÑÑ ÑÐ¸Ð»ÑÐ¼Ñ/ÑÐµÑÐ¸Ð°Ð»Ñ...',
    importPin: 'ÐÐ¾Ð±Ð°Ð²Ð¸ÑÑ ÑÐ¿Ð¸ÑÐ¾Ðº Ð¿Ð¾ PIN',
    copyUrl: 'ÐÐ¾Ð¿Ð¸ÑÐ¾Ð²Ð°ÑÑ URL ÑÑÑÐ°Ð½Ð¾Ð²ÐºÐ¸',
    install: 'Ð£ÑÑÐ°Ð½Ð¾Ð²Ð¸ÑÑ Ð² ÑÐ²Ð¾Ð¹ Ð¿Ð»ÐµÐµÑ',
    share: 'ÐÐ¾Ð´ÐµÐ»Ð¸ÑÑÑÑ',
    delete: 'Ð£Ð´Ð°Ð»Ð¸ÑÑ',
    selectListModal: 'Ð ÐºÐ°ÐºÐ¾Ð¹ ÑÐ¿Ð¸ÑÐ¾Ðº Ð´Ð¾Ð±Ð°Ð²Ð¸ÑÑ ÑÑÐ¾?',
    add: 'ÐÐ¾Ð±Ð°Ð²Ð¸ÑÑ',
    cancel: 'ÐÑÐ¼ÐµÐ½Ð¸ÑÑ',
    back: 'ÐÐ°Ð·Ð°Ð´',
    importPinTitle: 'ÐÐ²ÐµÐ´Ð¸ÑÐµ 6-Ð·Ð½Ð°ÑÐ½ÑÐ¹ PIN',
    import: 'ÐÐ¼Ð¿Ð¾ÑÑÐ¸ÑÐ¾Ð²Ð°ÑÑ',
    sharePinTitle: 'PIN ÑÐ¿Ð¸ÑÐºÐ°',
    sharePinText: 'ÐÐ¾Ð´ÐµÐ»Ð¸ÑÐµÑÑ ÑÑÐ¸Ð¼ PIN, ÑÑÐ¾Ð±Ñ Ð´ÑÑÐ³Ð¸Ðµ Ð¼Ð¾Ð³Ð»Ð¸ Ð¸Ð¼Ð¿Ð¾ÑÑÐ¸ÑÐ¾Ð²Ð°ÑÑ ÑÐ¿Ð¸ÑÐ¾Ðº',
    copyPin: 'ÐÐ¾Ð¿Ð¸ÑÐ¾Ð²Ð°ÑÑ PIN',
    close: 'ÐÐ°ÐºÑÑÑÑ',
    deleteItem: 'Ð£Ð´Ð°Ð»Ð¸ÑÑ',
    rate: 'ÐÑÐµÐ½Ð¸ÑÑ',
    rateTitle: 'ÐÑÐµÐ½Ð¸ÑÑ ÑÑÐ¾Ñ ÑÐ»ÐµÐ¼ÐµÐ½Ñ',
    reviewPlaceholder: 'ÐÐ°Ð¿Ð¸ÑÐ¸ÑÐµ Ð¾ÑÐ·ÑÐ² (Ð½ÐµÐ¾Ð±ÑÐ·Ð°ÑÐµÐ»ÑÐ½Ð¾)...',
    submit: 'ÐÑÐ¿ÑÐ°Ð²Ð¸ÑÑ',
    ratingsTitle: 'ÐÑÐµÐ½ÐºÐ¸',
    viewRatings: 'ÐÑÐµÐ½ÐºÐ¸',
    friends: 'ÐÑÑÐ·ÑÑ',
    friendUsername: 'ÐÐ¼Ñ Ð¿Ð¾Ð»ÑÐ·Ð¾Ð²Ð°ÑÐµÐ»Ñ',
    addFriend: 'ÐÐ¾Ð±Ð°Ð²Ð¸ÑÑ Ð´ÑÑÐ³Ð°',
    removeFriend: 'Ð£Ð´Ð°Ð»Ð¸ÑÑ',
    friendLists: 'Ð¡Ð¿Ð¸ÑÐºÐ¸',
    friendRatings: 'ÐÐµÐ´Ð°Ð²Ð½Ð¸Ðµ Ð¾ÑÐµÐ½ÐºÐ¸',
    noFriends: 'ÐÐ¾ÐºÐ° Ð½ÐµÑ Ð´ÑÑÐ·ÐµÐ¹',
    noLists: 'Ð¡Ð¿Ð¸ÑÐºÐ¾Ð² ÐµÑÐµ Ð½Ðµ ÑÐ¾Ð·Ð´Ð°Ð½Ð¾',
    noItems: 'Ð ÑÑÐ¾Ð¼ ÑÐ¿Ð¸ÑÐºÐµ Ð½ÐµÑ ÑÐ»ÐµÐ¼ÐµÐ½ÑÐ¾Ð²'
  },
  ja: {
    languageQuestionFirst: 'ãããä½èªã§è©±ãã¾ããï¼',
    welcomeQuestion: 'ãããããä½ã¨å¼ã¹ã°ããã§ããï¼',
    yourName: 'ããªãã®åå',
    continue: 'ç¶ãã',
    welcomeBack: 'ãããããªããï¼',
    enterPin: '4æ¡ã®PINãå¥å',
    login: 'ã­ã°ã¤ã³',
    newUser: 'æ°ããã¦ã¼ã¶ã¼ï¼',
    addonNameQuestion: 'ç§ã®ååã¯ï¼',
    addonNameHelp: 'ãããããªãã®ãã¬ã¼ã¤ã¼ã®ã¢ããªã³åã«ãªãã¾ã',
    tmdbQuestion: 'TMDB APIã­ã¼ãå¿è¦ã§ã',
    tmdbKeyPlaceholder: 'TMDB APIã­ã¼',
    getTmdbKeyText: 'ãã¡ãã§åå¾',
    here: 'ãã',
    createPin: '4æ¡ã®PINãä½æ',
    pinHelp: 'ã¢ã«ã¦ã³ãã«ã¢ã¯ã»ã¹ããããã«ä½¿ç¨',
    startButton: 'ãªã¹ããä½æãã¾ããã',
    mainTitleTemplate: 'ãããã¾ãã{{username}}ãããä½ãå¥½ãã§ãããï¼',
    yourLists: 'ããªãã®ãªã¹ã',
    createList: 'æ°ãããªã¹ããä½æ',
    listName: 'ãªã¹ãå',
    listTypeTemplate: '{{username}}ã®ã©ã¤ãã©ãª',
    create: 'ä½æ',
    searchPlaceholder: 'æ ç»/ã·ãªã¼ãºãæ¤ç´¢...',
    importPin: 'PINã§ãªã¹ããè¿½å ',
    copyUrl: 'ã¤ã³ã¹ãã¼ã«URLãã³ãã¼',
    install: 'ãã¬ã¼ã¤ã¼ã«ã¤ã³ã¹ãã¼ã«',
    share: 'å±æ',
    delete: 'åé¤',
    selectListModal: 'ã©ã®ãªã¹ãã«è¿½å ãã¾ããï¼',
    add: 'è¿½å ',
    cancel: 'ã­ã£ã³ã»ã«',
    back: 'æ»ã',
    importPinTitle: '6æ¡ã®PINãå¥å',
    import: 'ã¤ã³ãã¼ã',
    sharePinTitle: 'ãªã¹ãã®PIN',
    sharePinText: 'ãã®PINãå±æãã¦ä»ã®äººããªã¹ããã¤ã³ãã¼ãã§ããããã«ãã¾ã',
    copyPin: 'PINãã³ãã¼',
    close: 'éãã',
    deleteItem: 'åé¤',
    rate: 'è©ä¾¡',
    rateTitle: 'ãã®ã¢ã¤ãã ãè©ä¾¡',
    reviewPlaceholder: 'ã¬ãã¥ã¼ãæ¸ãï¼ãªãã·ã§ã³ï¼...',
    submit: 'éä¿¡',
    ratingsTitle: 'è©ä¾¡',
    viewRatings: 'è©ä¾¡',
    friends: 'åé',
    friendUsername: 'ã¦ã¼ã¶ã¼å',
    addFriend: 'åéãè¿½å ',
    removeFriend: 'åé¤',
    friendLists: 'ãªã¹ã',
    friendRatings: 'æè¿ã®è©ä¾¡',
    noFriends: 'ã¾ã åéããã¾ãã',
    noLists: 'ãªã¹ããã¾ã ä½æããã¦ãã¾ãã',
    noItems: 'ãã®ãªã¹ãã«ã¢ã¤ãã ãããã¾ãã'
  },
  zh: {
    languageQuestionFirst: 'å¿ï¼æä»¬å¯ä»¥è¯´ä»ä¹è¯­è¨ï¼',
    welcomeQuestion: 'æ¬¢è¿ï¼æè¯¥æä¹ç§°å¼ä½ ï¼',
    yourName: 'ä½ çåå­',
    continue: 'ç»§ç»­',
    welcomeBack: 'æ¬¢è¿åæ¥ï¼',
    enterPin: 'è¾å¥ä½ ç4ä½PIN',
    login: 'ç»å½',
    newUser: 'æ°ç¨æ·ï¼',
    addonNameQuestion: 'æå«ä»ä¹åå­ï¼',
    addonNameHelp: 'è¿å°æ¯ä½ æ­æ¾å¨ä¸­çæä»¶åç§°',
    tmdbQuestion: 'æéè¦ä½ çTMDB APIå¯é¥',
    tmdbKeyPlaceholder: 'TMDB APIå¯é¥',
    getTmdbKeyText: 'å¨è¿éè·å',
    here: 'è¿é',
    createPin: 'åå»º4ä½PIN',
    pinHelp: 'ç¨å®è®¿é®ä½ çè´¦æ·',
    startButton: 'è®©æä»¬åå»ºä½ çåè¡¨',
    mainTitleTemplate: 'å¥½ç{{username}}ï¼ä½ åæ¬¢ä»ä¹ï¼',
    yourLists: 'è¿äºæ¯ä½ çåè¡¨',
    createList: 'åå»ºæ°åè¡¨',
    listName: 'åè¡¨åç§°',
    listTypeTemplate: '{{username}}çå¾ä¹¦é¦',
    create: 'åå»º',
    searchPlaceholder: 'æç´¢çµå½±/ç³»å...',
    importPin: 'éè¿PINæ·»å åè¡¨',
    copyUrl: 'å¤å¶å®è£URL',
    install: 'å®è£å°æ­æ¾å¨',
    share: 'åäº«',
    delete: 'å é¤',
    selectListModal: 'ä½ æ³æ·»å å°åªä¸ªåè¡¨ï¼',
    add: 'æ·»å ',
    cancel: 'åæ¶',
    back: 'è¿å',
    importPinTitle: 'è¾å¥6ä½PIN',
    import: 'å¯¼å¥',
    sharePinTitle: 'åè¡¨PIN',
    sharePinText: 'åäº«æ­¤PINä»¥ä¾¿å¶ä»äººå¯¼å¥åè¡¨',
    copyPin: 'å¤å¶PIN',
    close: 'å³é­',
    deleteItem: 'å é¤',
    rate: 'è¯å',
    rateTitle: 'ä¸ºæ­¤é¡¹ç®è¯å',
    reviewPlaceholder: 'åè¯è®ºï¼å¯éï¼...',
    submit: 'æäº¤',
    ratingsTitle: 'è¯å',
    viewRatings: 'è¯å',
    friends: 'æå',
    friendUsername: 'ç¨æ·å',
    addFriend: 'æ·»å æå',
    removeFriend: 'å é¤',
    friendLists: 'åè¡¨',
    friendRatings: 'æè¿çè¯å',
    noFriends: 'è¿æ²¡ææå',
    noLists: 'è¿æ²¡æåå»ºåè¡¨',
    noItems: 'æ­¤åè¡¨ä¸­æ²¡æé¡¹ç®'
  }
};

let currentLang = 'en';
let currentUsername = '';
let currentTmdbKey = '';
let currentAddonName = '';
let pendingItem = null;
let currentListId = null;
let currentItemId = null;
let selectedRating = 0;
let tempUsername = '';

const welcomeUsername = document.getElementById('welcomeUsername');
const checkUserBtn = document.getElementById('checkUserBtn');
const langSelect = document.getElementById('langSelect');
const loginPin = document.getElementById('loginPin');
const loginBtn = document.getElementById('loginBtn');
const backToUsernameBtn = document.getElementById('backToUsernameBtn');
const addonNameInput = document.getElementById('addonName');
const registerTmdbKey = document.getElementById('registerTmdbKey');
const registerPin = document.getElementById('registerPin');
const registerBtn = document.getElementById('registerBtn');

function updateAddonName() {
  const t = translations[currentLang] || translations.en;
  const username = tempUsername || welcomeUsername.value.trim();
  if (username) {
    addonNameInput.value = t.listTypeTemplate.replace('{{username}}', username);
  }
}

function updateListTypePlaceholder() {
  const t = translations[currentLang] || translations.en;
  document.getElementById('listType').value = t.listTypeTemplate.replace('{{username}}', currentUsername);
}

langSelect.addEventListener('change', (e) => {
  currentLang = e.target.value;
  updateUI();
  updateAddonName();
});

welcomeUsername.addEventListener('input', () => {
  checkUserBtn.disabled = welcomeUsername.value.trim().length === 0;
});

checkUserBtn.addEventListener('click', async () => {
  tempUsername = welcomeUsername.value.trim();
  if (!tempUsername) return;
  
  const res = await fetch('/api/auth/check-user', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username: tempUsername })
  });
  
  const data = await res.json();
  
  if (data.exists) {
    currentLang = data.user.language || 'en';
    langSelect.value = currentLang;
    updateUI();
    
    document.getElementById('welcomeScreen').classList.remove('active');
    document.getElementById('loginScreen').classList.add('active');
    document.getElementById('welcomeBackText').textContent = `${translations[currentLang].welcomeBack} ${tempUsername}!`;
  } else {
    updateAddonName();
    document.getElementById('welcomeScreen').classList.remove('active');
    document.getElementById('registerScreen').classList.add('active');
  }
});

backToUsernameBtn.addEventListener('click', () => {
  document.getElementById('loginScreen').classList.remove('active');
  document.getElementById('welcomeScreen').classList.add('active');
  loginPin.value = '';
  tempUsername = '';
});

loginPin.addEventListener('input', () => {
  loginBtn.disabled = loginPin.value.length !== 4;
});

loginBtn.addEventListener('click', async () => {
  const pin = loginPin.value.trim();
  if (pin.length !== 4) return;
  
  const res = await fetch('/api/auth/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username: tempUsername, pin })
  });
  
  const data = await res.json();
  
  if (data.success) {
    currentUsername = tempUsername;
    currentTmdbKey = data.user.tmdb_key;
    currentAddonName = data.user.addon_name;
    currentLang = data.user.language || 'en';
    
    localStorage.setItem('username', currentUsername);
    localStorage.setItem('pin', pin);
    
    const t = translations[currentLang] || translations.en;
    document.getElementById('mainTitle').textContent = t.mainTitleTemplate.replace('{{username}}', currentUsername);
    
    document.getElementById('loginScreen').classList.remove('active');
    document.getElementById('mainScreen').classList.add('active');
    
    loadLists(currentUsername);
    loadFriends(currentUsername);
    updateListTypePlaceholder();
    updateUI();
  } else {
    alert(data.error || 'PIN incorrecto');
    loginPin.value = '';
  }
});

registerPin.addEventListener('input', () => {
  const hasAddonName = addonNameInput.value.trim().length > 0;
  const hasTmdbKey = registerTmdbKey.value.trim().length > 0;
  const hasPin = registerPin.value.length === 4;
  registerBtn.disabled = !(hasAddonName && hasTmdbKey && hasPin);
});

registerTmdbKey.addEventListener('input', () => {
  const hasAddonName = addonNameInput.value.trim().length > 0;
  const hasTmdbKey = registerTmdbKey.value.trim().length > 0;
  const hasPin = registerPin.value.length === 4;
  registerBtn.disabled = !(hasAddonName && hasTmdbKey && hasPin);
});

addonNameInput.addEventListener('input', () => {
  const hasAddonName = addonNameInput.value.trim().length > 0;
  const hasTmdbKey = registerTmdbKey.value.trim().length > 0;
  const hasPin = registerPin.value.length === 4;
  registerBtn.disabled = !(hasAddonName && hasTmdbKey && hasPin);
});

registerBtn.addEventListener('click', async () => {
  const addonName = addonNameInput.value.trim();
  const tmdbKey = registerTmdbKey.value.trim();
  const pin = registerPin.value.trim();
  
  if (!addonName || !tmdbKey || pin.length !== 4) return;
  
  const res = await fetch('/api/auth/register', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ 
      username: tempUsername, 
      pin, 
      addonName, 
      tmdbKey,
      language: currentLang
    })
  });
  
  const data = await res.json();
  
  if (data.success) {
    currentUsername = tempUsername;
    currentTmdbKey = tmdbKey;
    currentAddonName = addonName;
    
    localStorage.setItem('username', currentUsername);
    localStorage.setItem('pin', pin);
    
    const t = translations[currentLang] || translations.en;
    document.getElementById('mainTitle').textContent = t.mainTitleTemplate.replace('{{username}}', currentUsername);
    
    document.getElementById('registerScreen').classList.remove('active');
    document.getElementById('mainScreen').classList.add('active');
    
    loadLists(currentUsername);
    loadFriends(currentUsername);
    updateListTypePlaceholder();
  } else {
    alert(data.error || 'Error al registrar');
  }
});

document.getElementById('changeUserBtn').addEventListener('click', () => {
  if (!confirm('Â¿Cerrar sesiÃ³n?')) return;
  
  localStorage.removeItem('username');
  localStorage.removeItem('pin');
  
  currentUsername = '';
  currentTmdbKey = '';
  currentAddonName = '';
  tempUsername = '';
  
  welcomeUsername.value = '';
  loginPin.value = '';
  registerPin.value = '';
  registerTmdbKey.value = '';
  
  document.getElementById('mainScreen').classList.remove('active');
  document.getElementById('welcomeScreen').classList.add('active');
});

function updateUI() {
  const t = translations[currentLang] || translations.en;
  
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    if (t[key]) {
      if (key === 'mainTitleTemplate') {
        el.textContent = t[key].replace('{{username}}', currentUsername);
      } else {
        el.textContent = t[key];
      }
    }
  });
  
  document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
    const key = el.getAttribute('data-i18n-placeholder');
    if (t[key]) el.placeholder = t[key];
  });
}

document.getElementById('newListForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const name = document.getElementById('listName').value.trim();
  const type = document.getElementById('listType').value.trim();
  
  if (!name || !type) return;
  
  const res = await fetch('/api/lists', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username: currentUsername, list: { name, type } })
  });
  
  if (res.ok) {
    loadLists(currentUsername);
    e.target.reset();
    updateListTypePlaceholder();
  }
});

async function getOptimalId(tmdbId, mediaType) {
  try {
    if (!currentTmdbKey) return `tmdb:${tmdbId}`;
    
    const url = `https://api.themoviedb.org/3/${mediaType === 'tv' ? 'tv' : 'movie'}/${tmdbId}/external_ids?api_key=${currentTmdbKey}`;
    const res = await fetch(url);
    const data = await res.json();
    
    return data.imdb_id || `tmdb:${tmdbId}`;
  } catch (e) {
    return `tmdb:${tmdbId}`;
  }
}

function showListModal(item) {
  pendingItem = item;
  const modal = document.getElementById('listModal');
  modal.classList.add('active');
}

document.getElementById('modalCancelBtn').addEventListener('click', () => {
  document.getElementById('listModal').classList.remove('active');
  pendingItem = null;
});

document.getElementById('modalAddBtn').addEventListener('click', async () => {
  const listId = document.getElementById('modalListSelect').value;
  if (!listId || !pendingItem) return;

  const optimalId = await getOptimalId(pendingItem.tmdbId, pendingItem.mediaType);

  await fetch(`/api/lists/${listId}/items`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ 
      username: currentUsername, 
      item: { 
        tmdbId: pendingItem.tmdbId, 
        imdbId: optimalId, 
        mediaType: pendingItem.mediaType, 
        title: pendingItem.title, 
        poster: pendingItem.poster, 
        overview: pendingItem.overview, 
        rating: pendingItem.rating 
      } 
    })
  });
  
  alert('Â¡AÃ±adido correctamente!');
  document.getElementById('listModal').classList.remove('active');
  pendingItem = null;
  loadLists(currentUsername);
});

async function loadLists(username) {
  const res = await fetch(`/api/lists?username=${username}`);
  const lists = await res.json();
  
  const t = translations[currentLang] || translations.en;
  const display = document.getElementById('listDisplay');
  display.innerHTML = lists.length === 0 
    ? `<p style="text-align:center; opacity:0.7;">${t.noLists}</p>`
    : lists.map((list, idx) => `
    <div class="list-item" draggable="true" data-id="${list.id}" data-index="${idx}">
      <div class="list-info" onclick="showListDetail('${list.id}')">
        <strong>${escapeHtml(list.name)}</strong> <span style="opacity:0.8">(${escapeHtml(list.type)})</span><br>
        <small>${list.items?.length || 0} elementos</small>
      </div>
      <div class="list-actions">
        <button onclick="shareList('${list.id}', '${escapeHtml(list.name)}', '${list.pin}')">${t.share}</button>
        <button onclick="deleteList('${list.id}')" ${!list.isOwner ? 'disabled style="opacity:0.3"' : ''}>${t.delete}</button>
        <div class="arrows">
          <button onclick="moveList('${list.id}', ${idx}, -1)" ${idx === 0 ? 'disabled' : ''}>â²</button>
          <button onclick="moveList('${list.id}', ${idx}, 1)" ${idx === lists.length - 1 ? 'disabled' : ''}>â¼</button>
        </div>
      </div>
    </div>
  `).join('');
  
  document.querySelectorAll('.list-item').forEach(item => {
    item.addEventListener('dragstart', handleDragStart);
    item.addEventListener('dragover', handleDragOver);
    item.addEventListener('drop', handleDrop);
    item.addEventListener('dragend', handleDragEnd);
  });
  
  const modalListSelect = document.getElementById('modalListSelect');
  modalListSelect.innerHTML = lists.map(l => `<option value="${l.id}">${escapeHtml(l.name)}</option>`).join('');
}

async function loadFriends(username) {
  const res = await fetch(`/api/friends?username=${username}`);
  const friends = await res.json();
  
  const t = translations[currentLang] || translations.en;
  const display = document.getElementById('friendsDisplay');
  
  if (friends.length === 0) {
    display.innerHTML = `<p style="text-align:center; opacity:0.7;">${t.noFriends}</p>`;
  } else {
    display.innerHTML = friends.map(f => `
      <div class="friend-item">
        <div class="friend-info" onclick="showFriendDetail('${escapeHtml(f.friend_username)}')">
          <strong>${escapeHtml(f.friend_username)}</strong>
        </div>
        <button onclick="removeFriend('${escapeHtml(f.friend_username)}')">${t.removeFriend}</button>
      </div>
    `).join('');
  }
}

document.getElementById('addFriendForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const friendUsername = document.getElementById('friendUsername').value.trim();
  
  if (!friendUsername || friendUsername === currentUsername) {
    alert('Usuario invÃ¡lido');
    return;
  }
  
  const res = await fetch('/api/friends/add', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username: currentUsername, friendUsername })
  });
  
  if (res.ok) {
    loadFriends(currentUsername);
    e.target.reset();
  } else {
    const data = await res.json();
    alert(data.error || 'Error al aÃ±adir amigo');
  }
});

async function removeFriend(friendUsername) {
  if (!confirm(`Â¿Eliminar a ${friendUsername}?`)) return;
  
  await fetch(`/api/friends/${friendUsername}?username=${currentUsername}`, { method: 'DELETE' });
  loadFriends(currentUsername);
}

async function showFriendDetail(friendUsername) {
  document.getElementById('friendDetailTitle').textContent = friendUsername;
  
  const listsRes = await fetch(`/api/lists?username=${friendUsername}`);
  const lists = await listsRes.json();
  
  const t = translations[currentLang] || translations.en;
  const listsDisplay = document.getElementById('friendListsDisplay');
  
  listsDisplay.innerHTML = lists.length === 0
    ? `<p style="opacity:0.7;">${t.noLists}</p>`
    : lists.map(list => `
      <div class="list-item">
        <div class="list-info">
          <strong>${escapeHtml(list.name)}</strong> <span style="opacity:0.8">(${escapeHtml(list.type)})</span><br>
          <small>${list.items?.length || 0} elementos</small>
        </div>
      </div>
    `).join('');
  
  document.getElementById('friendRatingsDisplay').innerHTML = '<p style="opacity:0.7;">PrÃ³ximamente...</p>';
  
  document.getElementById('mainScreen').classList.remove('active');
  document.getElementById('friendDetailScreen').classList.add('active');
}

document.getElementById('backFromFriendBtn').addEventListener('click', () => {
  document.getElementById('friendDetailScreen').classList.remove('active');
  document.getElementById('mainScreen').classList.add('active');
});

function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

let draggedElement = null;

function handleDragStart(e) {
  draggedElement = this;
  this.classList.add('dragging');
  e.dataTransfer.effectAllowed = 'move';
}

function handleDragOver(e) {
  if (e.preventDefault) e.preventDefault();
  this.classList.add('drag-over');
  e.dataTransfer.dropEffect = 'move';
  return false;
}

function handleDrop(e) {
  if (e.stopPropagation) e.stopPropagation();
  
  if (draggedElement !== this) {
    const fromIndex = parseInt(draggedElement.dataset.index);
    const toIndex = parseInt(this.dataset.index);
    
    moveList(draggedElement.dataset.id, fromIndex, toIndex - fromIndex);
  }
  
  return false;
}

function handleDragEnd() {
  document.querySelectorAll('.list-item').forEach(item => {
    item.classList.remove('dragging', 'drag-over');
  });
}

async function shareList(id, name, pin) {
  document.getElementById('pinDisplay').textContent = pin;
  document.getElementById('showPinModal').classList.add('active');
}

document.getElementById('copyPinBtn').addEventListener('click', () => {
  const pin = document.getElementById('pinDisplay').textContent;
  navigator.clipboard.writeText(pin);
  alert('Â¡PIN copiado!');
});

document.getElementById('closePinBtn').addEventListener('click', () => {
  document.getElementById('showPinModal').classList.remove('active');
});

async function deleteList(id) {
  if (!confirm('Â¿Eliminar esta lista?')) return;
  await fetch(`/api/lists/${id}?username=${currentUsername}`, { method: 'DELETE' });
  loadLists(currentUsername);
}

async function moveList(id, currentIndex, direction) {
  const newOrder = currentIndex + direction;
  await fetch(`/api/lists/${id}/reorder`, {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username: currentUsername, newOrder })
  });
  loadLists(currentUsername);
}

document.getElementById('importBtn').addEventListener('click', () => {
  document.getElementById('pinModal').classList.add('active');
});

document.getElementById('pinCancelBtn').addEventListener('click', () => {
  document.getElementById('pinModal').classList.remove('active');
  document.getElementById('pinInput').value = '';
});

document.getElementById('pinImportBtn').addEventListener('click', async () => {
  const pin = document.getElementById('pinInput').value.trim();
  if (pin.length !== 6) {
    alert('El PIN debe tener 6 dÃ­gitos');
    return;
  }
  
  const res = await fetch('/api/lists/import-pin', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username: currentUsername, pin })
  });
  
  if (res.ok) {
    alert('Â¡Lista importada correctamente!');
    document.getElementById('pinModal').classList.remove('active');
    document.getElementById('pinInput').value = '';
    loadLists(currentUsername);
  } else {
    const data = await res.json();
    alert(data.error || 'PIN no vÃ¡lido');
  }
});

document.getElementById('copyInstallBtn').addEventListener('click', () => {
  const url = `${window.location.origin}/manifest.json?username=${currentUsername}&addonName=${encodeURIComponent(currentAddonName)}`;
  navigator.clipboard.writeText(url);
  alert('Â¡URL copiada!');
});

document.getElementById('installBtn').addEventListener('click', () => {
  const url = `stremio://${window.location.host}/manifest.json?username=${currentUsername}&addonName=${encodeURIComponent(currentAddonName)}`;
  window.open(url, '_blank');
});

async function showListDetail(listId) {
  currentListId = listId;
  const res = await fetch(`/api/lists/${listId}?username=${currentUsername}`);
  const list = await res.json();
  
  document.getElementById('listDetailTitle').textContent = list.name;
  
  const t = translations[currentLang] || translations.en;
  const itemsContainer = document.getElementById('listDetailItems');
  itemsContainer.innerHTML = list.items.length === 0
    ? `<p style="text-align:center; opacity:0.7;">${t.noItems}</p>`
    : list.items.map(item => `
      <div class="detail-item">
        <div class="detail-item-content">
          <img src="${item.poster ? `https://image.tmdb.org/t/p/w200${item.poster}` : 'image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'80\' height=\'120\'%3E%3Crect fill=\'%23333\' width=\'80\' height=\'120\'/%3E%3C/svg%3E'}" alt="${escapeHtml(item.title)}">
          <div class="detail-item-info">
            <div class="detail-item-title">
              <strong>${escapeHtml(item.title)}</strong>
              ${item.rating ? `<span class="rating">${escapeHtml(item.rating)}</span>` : ''}
            </div>
            <div class="overview">${escapeHtml(item.overview) || 'Sin sinopsis'}</div>
          </div>
        </div>
        <div class="detail-item-actions">
          <button onclick="openRatingModal('${item.id}')">${t.rate}</button>
          <button onclick="viewRatings('${item.id}')">${item.avgRating ? 'â­ ' + item.avgRating : t.viewRatings}</button>
          ${list.isOwner ? `<button class="delete-btn" onclick="deleteItem('${listId}', '${item.id}')">${t.deleteItem}</button>` : ''}
        </div>
      </div>
    `).join('');
  
  document.getElementById('mainScreen').classList.remove('active');
  document.getElementById('listDetailScreen').classList.add('active');
}

document.getElementById('backBtn').addEventListener('click', () => {
  document.getElementById('listDetailScreen').classList.remove('active');
  document.getElementById('mainScreen').classList.add('active');
  loadLists(currentUsername);
});

async function deleteItem(listId, itemId) {
  if (!confirm('Â¿Eliminar este elemento?')) return;
  
  await fetch(`/api/lists/${listId}/items/${itemId}?username=${currentUsername}`, { method: 'DELETE' });
  showListDetail(listId);
}

function openRatingModal(itemId) {
  currentItemId = itemId;
  selectedRating = 0;
  document.querySelectorAll('.star').forEach(star => star.classList.remove('active'));
  document.getElementById('reviewText').value = '';
  document.getElementById('ratingModal').classList.add('active');
}

document.querySelectorAll('.star').forEach(star => {
  star.addEventListener('click', function() {
    selectedRating = parseInt(this.dataset.rating);
    document.querySelectorAll('.star').forEach((s, idx) => {
      if (idx < selectedRating) {
        s.classList.add('active');
      } else {
        s.classList.remove('active');
      }
    });
  });
});

document.getElementById('submitRatingBtn').addEventListener('click', async () => {
  if (selectedRating === 0) {
    alert('Por favor selecciona una calificaciÃ³n');
    return;
  }
  
  const review = document.getElementById('reviewText').value.trim();
  
  await fetch(`/api/items/${currentItemId}/rate`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username: currentUsername, stars: selectedRating, review })
  });
  
  alert('Â¡CalificaciÃ³n guardada!');
  document.getElementById('ratingModal').classList.remove('active');
  showListDetail(currentListId);
});

document.getElementById('cancelRatingBtn').addEventListener('click', () => {
  document.getElementById('ratingModal').classList.remove('active');
});

async function viewRatings(itemId) {
  const res = await fetch(`/api/items/${itemId}/ratings`);
  const ratings = await res.json();
  
  const t = translations[currentLang] || translations.en;
  const display = document.getElementById('ratingsDisplay');
  
  if (ratings.length === 0) {
    display.innerHTML = '<p style="text-align:center; opacity:0.7;">No hay calificaciones aÃºn</p>';
  } else {
    display.innerHTML = ratings.map(r => `
      <div class="rating-item">
        <div class="rating-item-header">
          <span class="rating-item-user">${escapeHtml(r.username)}</span>
          <span class="rating-item-stars">${'â'.repeat(r.stars)}${'â'.repeat(5 - r.stars)}</span>
        </div>
        ${r.review ? `<div class="rating-item-review">${escapeHtml(r.review)}</div>` : ''}
      </div>
    `).join('');
  }
  
  document.getElementById('viewRatingsModal').classList.add('active');
}

document.getElementById('closeRatingsBtn').addEventListener('click', () => {
  document.getElementById('viewRatingsModal').classList.remove('active');
});

let searchTimeout;
document.getElementById('searchInput').addEventListener('input', (e) => {
  clearTimeout(searchTimeout);
  const q = e.target.value.trim();
  
  if (q.length === 0) {
    document.getElementById('searchResults').innerHTML = '';
    return;
  }
  
  if (q.length < 3 || !currentTmdbKey) return;
  
  searchTimeout = setTimeout(async () => {
    const langMap = { es: 'es-ES', en: 'en-US', fr: 'fr-FR', de: 'de-DE', it: 'it-IT', pt: 'pt-PT', ru: 'ru-RU', ja: 'ja-JP', zh: 'zh-CN' };
    const res = await fetch(`/api/tmdb/search?q=${encodeURIComponent(q)}&key=${currentTmdbKey}&lang=${langMap[currentLang] || 'en-US'}`);
    const data = await res.json();
    
    const results = (data.results || [])
      .filter(item => item.media_type === 'movie' || item.media_type === 'tv')
      .sort((a, b) => (b.vote_count || 0) - (a.vote_count || 0))
      .slice(0, 12);
    
    document.getElementById('searchResults').innerHTML = results
      .map(item => {
        const title = item.title || item.name;
        const mediaType = item.media_type;
        const overview = item.overview || 'No hay sinopsis disponible';
        const rating = item.vote_average ? `â­ ${item.vote_average.toFixed(1)}` : '';
        const poster = item.poster_path || '';
        
        const itemData = {
          tmdbId: item.id,
          mediaType: mediaType,
          title: title,
          poster: poster,
          overview: overview,
          rating: rating
        };
        
        const itemDataStr = JSON.stringify(itemData).replace(/"/g, '&quot;');
        
        return `
          <div class="search-item" onclick='showListModal(${itemDataStr})'>
            <img src="https://image.tmdb.org/t/p/w200${poster}" alt="${escapeHtml(title)}" onerror="this.src='image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'80\\' height=\\'120\\'%3E%3Crect fill=\\'%23333\\' width=\\'80\\' height=\\'120\\'/%3E%3C/svg%3E'">
            <div class="search-item-info">
              <strong>${escapeHtml(title)}</strong>
              <small>${mediaType.toUpperCase()}</small>
              ${rating ? `<div class="rating">${rating}</div>` : ''}
              <div class="overview">${escapeHtml(overview)}</div>
            </div>
          </div>
        `;
      }).join('');
  }, 600);
});

window.addEventListener('DOMContentLoaded', () => {
  const savedUsername = localStorage.getItem('username');
  const savedPin = localStorage.getItem('pin');
  
  if (savedUsername && savedPin) {
    fetch('/api/auth/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username: savedUsername, pin: savedPin })
    })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        currentUsername = savedUsername;
        currentTmdbKey = data.user.tmdb_key;
        currentAddonName = data.user.addon_name;
        currentLang = data.user.language || 'en';
        langSelect.value = currentLang;
        
        const t = translations[currentLang] || translations.en;
        document.getElementById('mainTitle').textContent = t.mainTitleTemplate.replace('{{username}}', currentUsername);
        
        document.getElementById('welcomeScreen').classList.remove('active');
        document.getElementById('mainScreen').classList.add('active');
        
        loadLists(currentUsername);
        loadFriends(currentUsername);
        updateListTypePlaceholder();
        updateUI();
      }
    });
  }
  
  updateUI();
});
