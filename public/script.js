const translations = {
  en: {
    languageQuestionFirst: 'Hey, what language can we speak?',
    welcomeQuestion: 'Welcome, what can I call you?',
    yourName: 'Your name',
    continue: 'Continue',
    welcomeBack: 'Welcome back!',
    enterPin: 'Enter your 4-digit PIN',
    login: 'Login',
    newUser: 'New user!',
    addonNameQuestion: 'And what should I be called?',
    addonNameHelp: 'This will be the addon name in your player',
    tmdbQuestion: "I'll need your TMDB API Key",
    tmdbKeyPlaceholder: 'TMDB API Key',
    getTmdbKeyText: 'Get it',
    here: 'HERE',
    createPin: 'Create a 4-digit PIN',
    pinHelp: 'Use it to access your account',
    startButton: "Let's create your lists",
    mainTitleTemplate: 'Alright {{username}}, what did you like?',
    yourLists: 'These are your lists',
    createList: 'Create new list',
    listName: 'List name',
    listTypeTemplate: "{{username}}'s library",
    create: 'Create',
    searchPlaceholder: 'Search movies/series...',
    importPin: 'Add list by PIN',
    copyUrl: 'Copy install URL',
    install: 'Install in your player',
    share: 'Share',
    delete: 'Delete',
    selectListModal: 'Which list do you want to add this to?',
    add: 'Add',
    cancel: 'Cancel',
    back: 'Back',
    importPinTitle: 'Enter the 6-digit PIN',
    import: 'Import',
    sharePinTitle: 'List PIN',
    sharePinText: 'Share this PIN so others can import the list',
    copyPin: 'Copy PIN',
    close: 'Close',
    deleteItem: 'Delete',
    rate: 'Rate',
    rateTitle: 'Rate this item',
    reviewPlaceholder: 'Write a review (optional)...',
    submit: 'Submit',
    ratingsTitle: 'Ratings',
    viewRatings: 'Ratings',
    friends: 'Friends',
    friendUsername: 'Username',
    addFriend: 'Add friend',
    removeFriend: 'Remove',
    friendLists: 'Lists',
    friendRatings: 'Recent ratings',
    noFriends: 'No friends yet',
    noLists: 'No lists created yet',
    noItems: 'No items in this list',
    showingAll: 'üåç Showing: All',
    showingFriends: 'üë• Showing: Friends'
  },
  es: {
    languageQuestionFirst: 'Ey, ¬øen qu√© idioma podemos hablar?',
    welcomeQuestion: 'Bienvenido, ¬øc√≥mo puedo llamarte?',
    yourName: 'Tu nombre',
    continue: 'Continuar',
    welcomeBack: '¬°Bienvenido de nuevo!',
    enterPin: 'Introduce tu PIN de 4 d√≠gitos',
    login: 'Iniciar sesi√≥n',
    newUser: '¬°Nuevo usuario!',
    addonNameQuestion: '¬øY c√≥mo me llamo yo?',
    addonNameHelp: 'Este ser√° el nombre del addon en tu reproductor',
    tmdbQuestion: 'Voy a necesitar tu clave API de TMDB',
    tmdbKeyPlaceholder: 'API Key de TMDB',
    getTmdbKeyText: 'Esto lo consigues',
    here: 'AQU√ç',
    createPin: 'Crea un PIN de 4 d√≠gitos',
    pinHelp: '√ösalo para acceder a tu cuenta',
    startButton: 'Pasemos a crear tus listas',
    mainTitleTemplate: 'De acuerdo {{username}}, ¬øqu√© fue eso que te gust√≥?',
    yourLists: 'Estas son tus listas',
    createList: 'Crear nueva lista',
    listName: 'Nombre de la lista',
    listTypeTemplate: 'Librer√≠a de {{username}}',
    create: 'Crear',
    searchPlaceholder: 'Buscar pel√≠culas/series...',
    importPin: 'A√±adir lista por PIN',
    copyUrl: 'Copiar URL de instalaci√≥n',
    install: 'Instalar en tu reproductor',
    share: 'Compartir',
    delete: 'Eliminar',
    selectListModal: '¬øA qu√© lista quieres agregar esto?',
    add: 'Agregar',
    cancel: 'Cancelar',
    back: 'Volver',
    importPinTitle: 'Introduce el PIN de 6 d√≠gitos',
    import: 'Importar',
    sharePinTitle: 'PIN de la lista',
    sharePinText: 'Comparte este PIN para que otros puedan importar la lista',
    copyPin: 'Copiar PIN',
    close: 'Cerrar',
    deleteItem: 'Eliminar',
    rate: 'Calificar',
    rateTitle: 'Calificar este elemento',
    reviewPlaceholder: 'Escribe una rese√±a (opcional)...',
    submit: 'Enviar',
    ratingsTitle: 'Calificaciones',
    viewRatings: 'Calificaciones',
    friends: 'Amigos',
    friendUsername: 'Nombre de usuario',
    addFriend: 'A√±adir amigo',
    removeFriend: 'Eliminar',
    friendLists: 'Listas',
    friendRatings: 'Calificaciones recientes',
    noFriends: 'A√∫n no tienes amigos',
    noLists: 'No hay listas creadas a√∫n',
    noItems: 'No hay elementos en esta lista',
    showingAll: 'üåç Mostrando: Todos',
    showingFriends: 'üë• Mostrando: Amigos'
  },
  fr: {
    languageQuestionFirst: 'H√©, quelle langue pouvons-nous parler?',
    welcomeQuestion: 'Bienvenue, comment puis-je t\'appeler?',
    yourName: 'Ton nom',
    continue: 'Continuer',
    welcomeBack: 'Bon retour!',
    enterPin: 'Entre ton PIN √† 4 chiffres',
    login: 'Connexion',
    newUser: 'Nouvel utilisateur!',
    addonNameQuestion: 'Et comment je m\'appelle?',
    addonNameHelp: 'Ce sera le nom de l\'addon dans ton lecteur',
    tmdbQuestion: 'J\'aurai besoin de ta cl√© API TMDB',
    tmdbKeyPlaceholder: 'Cl√© API TMDB',
    getTmdbKeyText: 'Obtiens-la',
    here: 'ICI',
    createPin: 'Cr√©e un PIN √† 4 chiffres',
    pinHelp: 'Utilise-le pour acc√©der √† ton compte',
    startButton: 'Cr√©ons tes listes',
    mainTitleTemplate: "D'accord {{username}}, qu'as-tu aim√©?",
    yourLists: 'Voici tes listes',
    createList: 'Cr√©er une nouvelle liste',
    listName: 'Nom de la liste',
    listTypeTemplate: 'Biblioth√®que de {{username}}',
    create: 'Cr√©er',
    searchPlaceholder: 'Rechercher films/s√©ries...',
    importPin: 'Ajouter une liste par PIN',
    copyUrl: 'Copier l\'URL d\'installation',
    install: 'Installer dans ton lecteur',
    share: 'Partager',
    delete: 'Supprimer',
    selectListModal: '√Ä quelle liste veux-tu ajouter ceci?',
    add: 'Ajouter',
    cancel: 'Annuler',
    back: 'Retour',
    importPinTitle: 'Entre le PIN √† 6 chiffres',
    import: 'Importer',
    sharePinTitle: 'PIN de la liste',
    sharePinText: 'Partage ce PIN pour que d\'autres puissent importer la liste',
    copyPin: 'Copier le PIN',
    close: 'Fermer',
    deleteItem: 'Supprimer',
    rate: 'Noter',
    rateTitle: 'Noter cet √©l√©ment',
    reviewPlaceholder: '√âcris un avis (optionnel)...',
    submit: 'Envoyer',
    ratingsTitle: 'Notes',
    viewRatings: 'Notes',
    friends: 'Amis',
    friendUsername: 'Nom d\'utilisateur',
    addFriend: 'Ajouter un ami',
    removeFriend: 'Supprimer',
    friendLists: 'Listes',
    friendRatings: 'Notes r√©centes',
    noFriends: 'Pas encore d\'amis',
    noLists: 'Aucune liste cr√©√©e',
    noItems: 'Aucun √©l√©ment dans cette liste',
    showingAll: 'üåç Affichage: Tous',
    showingFriends: 'üë• Affichage: Amis'
  },
  de: {
    languageQuestionFirst: 'Hey, welche Sprache k√∂nnen wir sprechen?',
    welcomeQuestion: 'Willkommen, wie kann ich dich nennen?',
    yourName: 'Dein Name',
    continue: 'Weiter',
    welcomeBack: 'Willkommen zur√ºck!',
    enterPin: 'Gib deine 4-stellige PIN ein',
    login: 'Anmelden',
    newUser: 'Neuer Benutzer!',
    addonNameQuestion: 'Und wie soll ich hei√üen?',
    addonNameHelp: 'Dies wird der Addon-Name in deinem Player sein',
    tmdbQuestion: 'Ich brauche deinen TMDB API-Schl√ºssel',
    tmdbKeyPlaceholder: 'TMDB API-Schl√ºssel',
    getTmdbKeyText: 'Hol ihn dir',
    here: 'HIER',
    createPin: 'Erstelle eine 4-stellige PIN',
    pinHelp: 'Verwende sie f√ºr den Zugriff auf dein Konto',
    startButton: 'Lass uns deine Listen erstellen',
    mainTitleTemplate: 'Ok {{username}}, was hat dir gefallen?',
    yourLists: 'Das sind deine Listen',
    createList: 'Neue Liste erstellen',
    listName: 'Listenname',
    listTypeTemplate: '{{username}}s Bibliothek',
    create: 'Erstellen',
    searchPlaceholder: 'Filme/Serien suchen...',
    importPin: 'Liste per PIN hinzuf√ºgen',
    copyUrl: 'Installations-URL kopieren',
    install: 'In deinem Player installieren',
    share: 'Teilen',
    delete: 'L√∂schen',
    selectListModal: 'Zu welcher Liste m√∂chtest du dies hinzuf√ºgen?',
    add: 'Hinzuf√ºgen',
    cancel: 'Abbrechen',
    back: 'Zur√ºck',
    importPinTitle: 'Gib die 6-stellige PIN ein',
    import: 'Importieren',
    sharePinTitle: 'Listen-PIN',
    sharePinText: 'Teile diese PIN, damit andere die Liste importieren k√∂nnen',
    copyPin: 'PIN kopieren',
    close: 'Schlie√üen',
    deleteItem: 'L√∂schen',
    rate: 'Bewerten',
    rateTitle: 'Dieses Element bewerten',
    reviewPlaceholder: 'Schreibe eine Bewertung (optional)...',
    submit: 'Senden',
    ratingsTitle: 'Bewertungen',
    viewRatings: 'Bewertungen',
    friends: 'Freunde',
    friendUsername: 'Benutzername',
    addFriend: 'Freund hinzuf√ºgen',
    removeFriend: 'Entfernen',
    friendLists: 'Listen',
    friendRatings: 'Aktuelle Bewertungen',
    noFriends: 'Noch keine Freunde',
    noLists: 'Noch keine Listen erstellt',
    noItems: 'Keine Elemente in dieser Liste',
    showingAll: 'üåç Anzeige: Alle',
    showingFriends: 'üë• Anzeige: Freunde'
  },
  it: {
    languageQuestionFirst: 'Ehi, che lingua possiamo parlare?',
    welcomeQuestion: 'Benvenuto, come posso chiamarti?',
    yourName: 'Il tuo nome',
    continue: 'Continua',
    welcomeBack: 'Bentornato!',
    enterPin: 'Inserisci il tuo PIN a 4 cifre',
    login: 'Accedi',
    newUser: 'Nuovo utente!',
    addonNameQuestion: 'E come mi chiamo io?',
    addonNameHelp: 'Questo sar√† il nome dell\'addon nel tuo lettore',
    tmdbQuestion: 'Avr√≤ bisogno della tua chiave API TMDB',
    tmdbKeyPlaceholder: 'Chiave API TMDB',
    getTmdbKeyText: 'Ottienila',
    here: 'QUI',
    createPin: 'Crea un PIN a 4 cifre',
    pinHelp: 'Usalo per accedere al tuo account',
    startButton: 'Creiamo le tue liste',
    mainTitleTemplate: 'Va bene {{username}}, cosa ti √® piaciuto?',
    yourLists: 'Queste sono le tue liste',
    createList: 'Crea nuova lista',
    listName: 'Nome della lista',
    listTypeTemplate: 'Biblioteca di {{username}}',
    create: 'Crea',
    searchPlaceholder: 'Cerca film/serie...',
    importPin: 'Aggiungi lista con PIN',
    copyUrl: 'Copia URL di installazione',
    install: 'Installa nel tuo lettore',
    share: 'Condividi',
    delete: 'Elimina',
    selectListModal: 'A quale lista vuoi aggiungere questo?',
    add: 'Aggiungi',
    cancel: 'Annulla',
    back: 'Indietro',
    importPinTitle: 'Inserisci il PIN a 6 cifre',
    import: 'Importa',
    sharePinTitle: 'PIN della lista',
    sharePinText: 'Condividi questo PIN affinch√© altri possano importare la lista',
    copyPin: 'Copia PIN',
    close: 'Chiudi',
    deleteItem: 'Elimina',
    rate: 'Vota',
    rateTitle: 'Vota questo elemento',
    reviewPlaceholder: 'Scrivi una recensione (opzionale)...',
    submit: 'Invia',
    ratingsTitle: 'Valutazioni',
    viewRatings: 'Valutazioni',
    friends: 'Amici',
    friendUsername: 'Nome utente',
    addFriend: 'Aggiungi amico',
    removeFriend: 'Rimuovi',
    friendLists: 'Liste',
    friendRatings: 'Valutazioni recenti',
    noFriends: 'Nessun amico ancora',
    noLists: 'Nessuna lista creata',
    noItems: 'Nessun elemento in questa lista',
    showingAll: 'üåç Visualizzazione: Tutti',
    showingFriends: 'üë• Visualizzazione: Amici'
  },
  pt: {
    languageQuestionFirst: 'Ei, que idioma podemos falar?',
    welcomeQuestion: 'Bem-vindo, como posso te chamar?',
    yourName: 'Seu nome',
    continue: 'Continuar',
    welcomeBack: 'Bem-vindo de volta!',
    enterPin: 'Digite seu PIN de 4 d√≠gitos',
    login: 'Entrar',
    newUser: 'Novo usu√°rio!',
    addonNameQuestion: 'E como eu me chamo?',
    addonNameHelp: 'Este ser√° o nome do addon no seu player',
    tmdbQuestion: 'Vou precisar da sua chave API TMDB',
    tmdbKeyPlaceholder: 'Chave API TMDB',
    getTmdbKeyText: 'Consiga',
    here: 'AQUI',
    createPin: 'Crie um PIN de 4 d√≠gitos',
    pinHelp: 'Use-o para acessar sua conta',
    startButton: 'Vamos criar suas listas',
    mainTitleTemplate: 'Certo {{username}}, do que voc√™ gostou?',
    yourLists: 'Estas s√£o suas listas',
    createList: 'Criar nova lista',
    listName: 'Nome da lista',
    listTypeTemplate: 'Biblioteca de {{username}}',
    create: 'Criar',
    searchPlaceholder: 'Pesquisar filmes/s√©ries...',
    importPin: 'Adicionar lista por PIN',
    copyUrl: 'Copiar URL de instala√ß√£o',
    install: 'Instalar no seu player',
    share: 'Compartilhar',
    delete: 'Excluir',
    selectListModal: 'A qual lista voc√™ quer adicionar isto?',
    add: 'Adicionar',
    cancel: 'Cancelar',
    back: 'Voltar',
    importPinTitle: 'Digite o PIN de 6 d√≠gitos',
    import: 'Importar',
    sharePinTitle: 'PIN da lista',
    sharePinText: 'Compartilhe este PIN para que outros possam importar a lista',
    copyPin: 'Copiar PIN',
    close: 'Fechar',
    deleteItem: 'Excluir',
    rate: 'Avaliar',
    rateTitle: 'Avaliar este item',
    reviewPlaceholder: 'Escreva uma avalia√ß√£o (opcional)...',
    submit: 'Enviar',
    ratingsTitle: 'Avalia√ß√µes',
    viewRatings: 'Avalia√ß√µes',
    friends: 'Amigos',
    friendUsername: 'Nome de usu√°rio',
    addFriend: 'Adicionar amigo',
    removeFriend: 'Remover',
    friendLists: 'Listas',
    friendRatings: 'Avalia√ß√µes recentes',
    noFriends: 'Ainda sem amigos',
    noLists: 'Nenhuma lista criada',
    noItems: 'Nenhum item nesta lista',
    showingAll: 'üåç Exibindo: Todos',
    showingFriends: 'üë• Exibindo: Amigos'
  },
  ru: {
    languageQuestionFirst: '–≠–π, –Ω–∞ –∫–∞–∫–æ–º —è–∑—ã–∫–µ –º—ã –º–æ–∂–µ–º –≥–æ–≤–æ—Ä–∏—Ç—å?',
    welcomeQuestion: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, –∫–∞–∫ –º–Ω–µ —Ç–µ–±—è –Ω–∞–∑—ã–≤–∞—Ç—å?',
    yourName: '–¢–≤–æ–µ –∏–º—è',
    continue: '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å',
    welcomeBack: '–° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º!',
    enterPin: '–í–≤–µ–¥–∏ —Å–≤–æ–π 4-–∑–Ω–∞—á–Ω—ã–π PIN',
    login: '–í–æ–π—Ç–∏',
    newUser: '–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å!',
    addonNameQuestion: '–ê –∫–∞–∫ –º–µ–Ω—è –∑–æ–≤—É—Ç?',
    addonNameHelp: '–≠—Ç–æ –±—É–¥–µ—Ç –∏–º—è –∞–¥–¥–æ–Ω–∞ –≤ —Ç–≤–æ–µ–º –ø–ª–µ–µ—Ä–µ',
    tmdbQuestion: '–ú–Ω–µ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è —Ç–≤–æ–π API –∫–ª—é—á TMDB',
    tmdbKeyPlaceholder: 'API –∫–ª—é—á TMDB',
    getTmdbKeyText: '–ü–æ–ª—É—á–∏ –µ–≥–æ',
    here: '–ó–î–ï–°–¨',
    createPin: '–°–æ–∑–¥–∞–π 4-–∑–Ω–∞—á–Ω—ã–π PIN',
    pinHelp: '–ò—Å–ø–æ–ª—å–∑—É–π –µ–≥–æ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–∫–∫–∞—É–Ω—Ç—É',
    startButton: '–î–∞–≤–∞–π —Å–æ–∑–¥–∞–¥–∏–º —Ç–≤–æ–∏ —Å–ø–∏—Å–∫–∏',
    mainTitleTemplate: '–•–æ—Ä–æ—à–æ {{username}}, —á—Ç–æ —Ç–µ–±–µ –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å?',
    yourLists: '–í–æ—Ç —Ç–≤–æ–∏ —Å–ø–∏—Å–∫–∏',
    createList: '–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Å–ø–∏—Å–æ–∫',
    listName: '–ù–∞–∑–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞',
    listTypeTemplate: '–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ {{username}}',
    create: '–°–æ–∑–¥–∞—Ç—å',
    searchPlaceholder: '–ò—Å–∫–∞—Ç—å —Ñ–∏–ª—å–º—ã/—Å–µ—Ä–∏–∞–ª—ã...',
    importPin: '–î–æ–±–∞–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ PIN',
    copyUrl: '–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å URL —É—Å—Ç–∞–Ω–æ–≤–∫–∏',
    install: '–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤ —Ç–≤–æ–π –ø–ª–µ–µ—Ä',
    share: '–ü–æ–¥–µ–ª–∏—Ç—å—Å—è',
    delete: '–£–¥–∞–ª–∏—Ç—å',
    selectListModal: '–í –∫–∞–∫–æ–π —Å–ø–∏—Å–æ–∫ –¥–æ–±–∞–≤–∏—Ç—å —ç—Ç–æ?',
    add: '–î–æ–±–∞–≤–∏—Ç—å',
    cancel: '–û—Ç–º–µ–Ω–∏—Ç—å',
    back: '–ù–∞–∑–∞–¥',
    importPinTitle: '–í–≤–µ–¥–∏—Ç–µ 6-–∑–Ω–∞—á–Ω—ã–π PIN',
    import: '–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å',
    sharePinTitle: 'PIN —Å–ø–∏—Å–∫–∞',
    sharePinText: '–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —ç—Ç–∏–º PIN, —á—Ç–æ–±—ã –¥—Ä—É–≥–∏–µ –º–æ–≥–ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫',
    copyPin: '–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å PIN',
    close: '–ó–∞–∫—Ä—ã—Ç—å',
    deleteItem: '–£–¥–∞–ª–∏—Ç—å',
    rate: '–û—Ü–µ–Ω–∏—Ç—å',
    rateTitle: '–û—Ü–µ–Ω–∏—Ç—å —ç—Ç–æ—Ç —ç–ª–µ–º–µ–Ω—Ç',
    reviewPlaceholder: '–ù–∞–ø–∏—à–∏—Ç–µ –æ—Ç–∑—ã–≤ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)...',
    submit: '–û—Ç–ø—Ä–∞–≤–∏—Ç—å',
    ratingsTitle: '–û—Ü–µ–Ω–∫–∏',
    viewRatings: '–û—Ü–µ–Ω–∫–∏',
    friends: '–î—Ä—É–∑—å—è',
    friendUsername: '–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',
    addFriend: '–î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∞',
    removeFriend: '–£–¥–∞–ª–∏—Ç—å',
    friendLists: '–°–ø–∏—Å–∫–∏',
    friendRatings: '–ù–µ–¥–∞–≤–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏',
    noFriends: '–ü–æ–∫–∞ –Ω–µ—Ç –¥—Ä—É–∑–µ–π',
    noLists: '–°–ø–∏—Å–∫–æ–≤ –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω–æ',
    noItems: '–í —ç—Ç–æ–º —Å–ø–∏—Å–∫–µ –Ω–µ—Ç —ç–ª–µ–º–µ–Ω—Ç–æ–≤',
    showingAll: 'üåç –ü–æ–∫–∞–∑–∞–Ω–æ: –í—Å–µ',
    showingFriends: 'üë• –ü–æ–∫–∞–∑–∞–Ω–æ: –î—Ä—É–∑—å—è'
  },
  ja: {
    languageQuestionFirst: '„ÇÑ„ÅÇ„ÄÅ‰ΩïË™û„ÅßË©±„Åõ„Åæ„Åô„ÅãÔºü',
    welcomeQuestion: '„Çà„ÅÜ„Åì„Åù„ÄÅ‰Ωï„Å®Âëº„Åπ„Å∞„ÅÑ„ÅÑ„Åß„Åô„ÅãÔºü',
    yourName: '„ÅÇ„Å™„Åü„ÅÆÂêçÂâç',
    continue: 'Á∂ö„Åë„Çã',
    welcomeBack: '„Åä„Åã„Åà„Çä„Å™„Åï„ÅÑÔºÅ',
    enterPin: '4Ê°Å„ÅÆPIN„ÇíÂÖ•Âäõ',
    login: '„É≠„Ç∞„Ç§„É≥',
    newUser: 'Êñ∞„Åó„ÅÑ„É¶„Éº„Ç∂„ÉºÔºÅ',
    addonNameQuestion: 'ÁßÅ„ÅÆÂêçÂâç„ÅØÔºü',
    addonNameHelp: '„Åì„Çå„Åå„ÅÇ„Å™„Åü„ÅÆ„Éó„É¨„Éº„É§„Éº„ÅÆ„Ç¢„Éâ„Ç™„É≥Âêç„Å´„Å™„Çä„Åæ„Åô',
    tmdbQuestion: 'TMDB API„Ç≠„Éº„ÅåÂøÖË¶Å„Åß„Åô',
    tmdbKeyPlaceholder: 'TMDB API„Ç≠„Éº',
    getTmdbKeyText: '„Åì„Å°„Çâ„ÅßÂèñÂæó',
    here: '„Åì„Åì',
    createPin: '4Ê°Å„ÅÆPIN„Çí‰ΩúÊàê',
    pinHelp: '„Ç¢„Ç´„Ç¶„É≥„Éà„Å´„Ç¢„ÇØ„Çª„Çπ„Åô„Çã„Åü„ÇÅ„Å´‰ΩøÁî®',
    startButton: '„É™„Çπ„Éà„Çí‰ΩúÊàê„Åó„Åæ„Åó„Çá„ÅÜ',
    mainTitleTemplate: '„Çè„Åã„Çä„Åæ„Åó„Åü{{username}}„Åï„Çì„ÄÅ‰Ωï„ÅåÂ•Ω„Åç„Åß„Åó„Åü„ÅãÔºü',
    yourLists: '„ÅÇ„Å™„Åü„ÅÆ„É™„Çπ„Éà',
    createList: 'Êñ∞„Åó„ÅÑ„É™„Çπ„Éà„Çí‰ΩúÊàê',
    listName: '„É™„Çπ„ÉàÂêç',
    listTypeTemplate: '{{username}}„ÅÆ„É©„Ç§„Éñ„É©„É™',
    create: '‰ΩúÊàê',
    searchPlaceholder: 'Êò†Áîª/„Ç∑„É™„Éº„Ç∫„ÇíÊ§úÁ¥¢...',
    importPin: 'PIN„Åß„É™„Çπ„Éà„ÇíËøΩÂä†',
    copyUrl: '„Ç§„É≥„Çπ„Éà„Éº„É´URL„Çí„Ç≥„Éî„Éº',
    install: '„Éó„É¨„Éº„É§„Éº„Å´„Ç§„É≥„Çπ„Éà„Éº„É´',
    share: 'ÂÖ±Êúâ',
    delete: 'ÂâäÈô§',
    selectListModal: '„Å©„ÅÆ„É™„Çπ„Éà„Å´ËøΩÂä†„Åó„Åæ„Åô„ÅãÔºü',
    add: 'ËøΩÂä†',
    cancel: '„Ç≠„É£„É≥„Çª„É´',
    back: 'Êàª„Çã',
    importPinTitle: '6Ê°Å„ÅÆPIN„ÇíÂÖ•Âäõ',
    import: '„Ç§„É≥„Éù„Éº„Éà',
    sharePinTitle: '„É™„Çπ„Éà„ÅÆPIN',
    sharePinText: '„Åì„ÅÆPIN„ÇíÂÖ±Êúâ„Åó„Å¶‰ªñ„ÅÆ‰∫∫„Åå„É™„Çπ„Éà„Çí„Ç§„É≥„Éù„Éº„Éà„Åß„Åç„Çã„Çà„ÅÜ„Å´„Åó„Åæ„Åô',
    copyPin: 'PIN„Çí„Ç≥„Éî„Éº',
    close: 'Èñâ„Åò„Çã',
    deleteItem: 'ÂâäÈô§',
    rate: 'Ë©ï‰æ°',
    rateTitle: '„Åì„ÅÆ„Ç¢„Ç§„ÉÜ„É†„ÇíË©ï‰æ°',
    reviewPlaceholder: '„É¨„Éì„É•„Éº„ÇíÊõ∏„ÅèÔºà„Ç™„Éó„Ç∑„Éß„É≥Ôºâ...',
    submit: 'ÈÄÅ‰ø°',
    ratingsTitle: 'Ë©ï‰æ°',
    viewRatings: 'Ë©ï‰æ°',
    friends: 'ÂèãÈÅî',
    friendUsername: '„É¶„Éº„Ç∂„ÉºÂêç',
    addFriend: 'ÂèãÈÅî„ÇíËøΩÂä†',
    removeFriend: 'ÂâäÈô§',
    friendLists: '„É™„Çπ„Éà',
    friendRatings: 'ÊúÄËøë„ÅÆË©ï‰æ°',
    noFriends: '„Åæ„Å†ÂèãÈÅî„Åå„ÅÑ„Åæ„Åõ„Çì',
    noLists: '„É™„Çπ„Éà„Åå„Åæ„Å†‰ΩúÊàê„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì',
    noItems: '„Åì„ÅÆ„É™„Çπ„Éà„Å´„Ç¢„Ç§„ÉÜ„É†„Åå„ÅÇ„Çä„Åæ„Åõ„Çì',
    showingAll: 'üåç Ë°®Á§∫: „Åô„Åπ„Å¶',
    showingFriends: 'üë• Ë°®Á§∫: ÂèãÈÅî'
  },
  zh: {
    languageQuestionFirst: 'ÂòøÔºåÊàë‰ª¨ÂèØ‰ª•ËØ¥‰ªÄ‰πàËØ≠Ë®ÄÔºü',
    welcomeQuestion: 'Ê¨¢ËøéÔºåÊàëËØ•ÊÄé‰πàÁß∞Âëº‰Ω†Ôºü',
    yourName: '‰Ω†ÁöÑÂêçÂ≠ó',
    continue: 'ÁªßÁª≠',
    welcomeBack: 'Ê¨¢ËøéÂõûÊù•ÔºÅ',
    enterPin: 'ËæìÂÖ•‰Ω†ÁöÑ4‰ΩçPIN',
    login: 'ÁôªÂΩï',
    newUser: 'Êñ∞Áî®Êà∑ÔºÅ',
    addonNameQuestion: 'ÊàëÂè´‰ªÄ‰πàÂêçÂ≠óÔºü',
    addonNameHelp: 'ËøôÂ∞ÜÊòØ‰Ω†Êí≠ÊîæÂô®‰∏≠ÁöÑÊèí‰ª∂ÂêçÁß∞',
    tmdbQuestion: 'ÊàëÈúÄË¶Å‰Ω†ÁöÑTMDB APIÂØÜÈí•',
    tmdbKeyPlaceholder: 'TMDB APIÂØÜÈí•',
    getTmdbKeyText: 'Âú®ËøôÈáåËé∑Âèñ',
    here: 'ËøôÈáå',
    createPin: 'ÂàõÂª∫4‰ΩçPIN',
    pinHelp: 'Áî®ÂÆÉËÆøÈóÆ‰Ω†ÁöÑË¥¶Êà∑',
    startButton: 'ËÆ©Êàë‰ª¨ÂàõÂª∫‰Ω†ÁöÑÂàóË°®',
    mainTitleTemplate: 'Â•ΩÁöÑ{{username}}Ôºå‰Ω†ÂñúÊ¨¢‰ªÄ‰πàÔºü',
    yourLists: 'Ëøô‰∫õÊòØ‰Ω†ÁöÑÂàóË°®',
    createList: 'ÂàõÂª∫Êñ∞ÂàóË°®',
    listName: 'ÂàóË°®ÂêçÁß∞',
    listTypeTemplate: '{{username}}ÁöÑÂõæ‰π¶È¶Ü',
    create: 'ÂàõÂª∫',
    searchPlaceholder: 'ÊêúÁ¥¢ÁîµÂΩ±/Á≥ªÂàó...',
    importPin: 'ÈÄöËøáPINÊ∑ªÂä†ÂàóË°®',
    copyUrl: 'Â§çÂà∂ÂÆâË£ÖURL',
    install: 'ÂÆâË£ÖÂà∞Êí≠ÊîæÂô®',
    share: 'ÂàÜ‰∫´',
    delete: 'Âà†Èô§',
    selectListModal: '‰Ω†ÊÉ≥Ê∑ªÂä†Âà∞Âì™‰∏™ÂàóË°®Ôºü',
    add: 'Ê∑ªÂä†',
    cancel: 'ÂèñÊ∂à',
    back: 'ËøîÂõû',
    importPinTitle: 'ËæìÂÖ•6‰ΩçPIN',
    import: 'ÂØºÂÖ•',
    sharePinTitle: 'ÂàóË°®PIN',
    sharePinText: 'ÂàÜ‰∫´Ê≠§PIN‰ª•‰æøÂÖ∂‰ªñ‰∫∫ÂØºÂÖ•ÂàóË°®',
    copyPin: 'Â§çÂà∂PIN',
    close: 'ÂÖ≥Èó≠',
    deleteItem: 'Âà†Èô§',
    rate: 'ËØÑÂàÜ',
    rateTitle: '‰∏∫Ê≠§È°πÁõÆËØÑÂàÜ',
    reviewPlaceholder: 'ÂÜôËØÑËÆ∫ÔºàÂèØÈÄâÔºâ...',
    submit: 'Êèê‰∫§',
    ratingsTitle: 'ËØÑÂàÜ',
    viewRatings: 'ËØÑÂàÜ',
    friends: 'ÊúãÂèã',
    friendUsername: 'Áî®Êà∑Âêç',
    addFriend: 'Ê∑ªÂä†ÊúãÂèã',
    removeFriend: 'Âà†Èô§',
    friendLists: 'ÂàóË°®',
    friendRatings: 'ÊúÄËøëÁöÑËØÑÂàÜ',
    noFriends: 'ËøòÊ≤°ÊúâÊúãÂèã',
    noLists: 'ËøòÊ≤°ÊúâÂàõÂª∫ÂàóË°®',
    noItems: 'Ê≠§ÂàóË°®‰∏≠Ê≤°ÊúâÈ°πÁõÆ',
    showingAll: 'üåç ÊòæÁ§∫: ÂÖ®ÈÉ®',
    showingFriends: 'üë• ÊòæÁ§∫: ÊúãÂèã'
  }
};

let currentLang = 'en';
let currentUsername = '';
let currentTmdbKey = '';
let currentAddonName = '';
let pendingItem = null;
let currentListId = null;
let currentItemId = null;
let selectedRating = 0;
let tempUsername = '';
let ratingsFilterFriendsOnly = false;
let currentRatingsItemId = null;

const welcomeUsername = document.getElementById('welcomeUsername');
const checkUserBtn = document.getElementById('checkUserBtn');
const langSelect = document.getElementById('langSelect');
const loginPin = document.getElementById('loginPin');
const loginBtn = document.getElementById('loginBtn');
const backToUsernameBtn = document.getElementById('backToUsernameBtn');
const addonNameInput = document.getElementById('addonName');
const registerTmdbKey = document.getElementById('registerTmdbKey');
const registerPin = document.getElementById('registerPin');
const registerBtn = document.getElementById('registerBtn');

function updateAddonName() {
  const t = translations[currentLang] || translations.en;
  const username = tempUsername || welcomeUsername.value.trim();
  if (username) {
    addonNameInput.value = t.listTypeTemplate.replace('{{username}}', username);
  }
}

function updateListTypePlaceholder() {
  const t = translations[currentLang] || translations.en;
  document.getElementById('listType').value = t.listTypeTemplate.replace('{{username}}', currentUsername);
}

langSelect.addEventListener('change', (e) => {
  currentLang = e.target.value;
  updateUI();
  updateAddonName();
});

welcomeUsername.addEventListener('input', () => {
  checkUserBtn.disabled = welcomeUsername.value.trim().length === 0;
});

checkUserBtn.addEventListener('click', async () => {
  tempUsername = welcomeUsername.value.trim();
  if (!tempUsername) return;

  const res = await fetch('/api/auth/check-user', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username: tempUsername })
  });
  const data = await res.json();

  if (data.exists) {
    currentLang = data.user.language || 'en';
    langSelect.value = currentLang;
    updateUI();
    document.getElementById('welcomeScreen').classList.remove('active');
    document.getElementById('loginScreen').classList.add('active');
    document.getElementById('welcomeBackText').textContent = `${translations[currentLang].welcomeBack} ${tempUsername}!`;
  } else {
    updateAddonName();
    document.getElementById('welcomeScreen').classList.remove('active');
    document.getElementById('registerScreen').classList.add('active');
  }
});

backToUsernameBtn.addEventListener('click', () => {
  document.getElementById('loginScreen').classList.remove('active');
  document.getElementById('welcomeScreen').classList.add('active');
  loginPin.value = '';
  tempUsername = '';
});

loginPin.addEventListener('input', () => {
  loginBtn.disabled = loginPin.value.length !== 4;
});

loginBtn.addEventListener('click', async () => {
  const pin = loginPin.value.trim();
  if (pin.length !== 4) return;

  const res = await fetch('/api/auth/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username: tempUsername, pin })
  });
  const data = await res.json();

  if (data.success) {
    currentUsername = tempUsername;
    currentTmdbKey = data.user.tmdb_key;
    currentAddonName = data.user.addon_name;
    currentLang = data.user.language || 'en';
    localStorage.setItem('username', currentUsername);
    localStorage.setItem('pin', pin);

    const t = translations[currentLang] || translations.en;
    document.getElementById('mainTitle').textContent = t.mainTitleTemplate.replace('{{username}}', currentUsername);

    document.getElementById('loginScreen').classList.remove('active');
    document.getElementById('mainScreen').classList.add('active');
    loadLists(currentUsername);
    loadFriends(currentUsername);
    updateListTypePlaceholder();
    updateUI();
  } else {
    alert(data.error || 'PIN incorrecto');
    loginPin.value = '';
  }
});

registerPin.addEventListener('input', () => {
  const hasAddonName = addonNameInput.value.trim().length > 0;
  const hasTmdbKey = registerTmdbKey.value.trim().length > 0;
  const hasPin = registerPin.value.length === 4;
  registerBtn.disabled = !(hasAddonName && hasTmdbKey && hasPin);
});

registerTmdbKey.addEventListener('input', () => {
  const hasAddonName = addonNameInput.value.trim().length > 0;
  const hasTmdbKey = registerTmdbKey.value.trim().length > 0;
  const hasPin = registerPin.value.length === 4;
  registerBtn.disabled = !(hasAddonName && hasTmdbKey && hasPin);
});

addonNameInput.addEventListener('input', () => {
  const hasAddonName = addonNameInput.value.trim().length > 0;
  const hasTmdbKey = registerTmdbKey.value.trim().length > 0;
  const hasPin = registerPin.value.length === 4;
  registerBtn.disabled = !(hasAddonName && hasTmdbKey && hasPin);
});

registerBtn.addEventListener('click', async () => {
  const addonName = addonNameInput.value.trim();
  const tmdbKey = registerTmdbKey.value.trim();
  const pin = registerPin.value.trim();

  if (!addonName || !tmdbKey || pin.length !== 4) return;

  const res = await fetch('/api/auth/register', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username: tempUsername, pin, addonName, tmdbKey, language: currentLang })
  });
  const data = await res.json();

  if (data.success) {
    currentUsername = tempUsername;
    currentTmdbKey = tmdbKey;
    currentAddonName = addonName;
    localStorage.setItem('username', currentUsername);
    localStorage.setItem('pin', pin);

    const t = translations[currentLang] || translations.en;
    document.getElementById('mainTitle').textContent = t.mainTitleTemplate.replace('{{username}}', currentUsername);

    document.getElementById('registerScreen').classList.remove('active');
    document.getElementById('mainScreen').classList.add('active');
    loadLists(currentUsername);
    loadFriends(currentUsername);
    updateListTypePlaceholder();
  } else {
    alert(data.error || 'Error al registrar');
  }
});

document.getElementById('changeUserBtn').addEventListener('click', () => {
  if (!confirm('¬øCerrar sesi√≥n?')) return;
  localStorage.removeItem('username');
  localStorage.removeItem('pin');
  currentUsername = '';
  currentTmdbKey = '';
  currentAddonName = '';
  tempUsername = '';
  welcomeUsername.value = '';
  loginPin.value = '';
  registerPin.value = '';
  registerTmdbKey.value = '';
  document.getElementById('mainScreen').classList.remove('active');
  document.getElementById('welcomeScreen').classList.add('active');
});

function updateUI() {
  const t = translations[currentLang] || translations.en;
  
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    if (t[key]) {
      if (key === 'mainTitleTemplate') {
        el.textContent = t[key].replace('{{username}}', currentUsername);
      } else {
        el.textContent = t[key];
      }
    }
  });
  
  document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
    const key = el.getAttribute('data-i18n-placeholder');
    if (t[key]) el.placeholder = t[key];
  });
}

document.getElementById('newListForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const name = document.getElementById('listName').value.trim();
  const type = document.getElementById('listType').value.trim();
  if (!name || !type) return;

  const res = await fetch('/api/lists', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username: currentUsername, list: { name, type } })
  });

  if (res.ok) {
    loadLists(currentUsername);
    e.target.reset();
    updateListTypePlaceholder();
  }
});

async function getOptimalId(tmdbId, mediaType) {
  try {
    if (!currentTmdbKey) return `tmdb:${tmdbId}`;
    const url = `https://api.themoviedb.org/3/${mediaType === 'tv' ? 'tv' : 'movie'}/${tmdbId}/external_ids?api_key=${currentTmdbKey}`;
    const res = await fetch(url);
    const data = await res.json();
    return data.imdb_id || `tmdb:${tmdbId}`;
  } catch (e) {
    return `tmdb:${tmdbId}`;
  }
}

function showListModal(item) {
  pendingItem = item;
  const modal = document.getElementById('listModal');
  modal.classList.add('active');
}

document.getElementById('modalCancelBtn').addEventListener('click', () => {
  document.getElementById('listModal').classList.remove('active');
  pendingItem = null;
});

document.getElementById('modalAddBtn').addEventListener('click', async () => {
  const listId = document.getElementById('modalListSelect').value;
  if (!listId || !pendingItem) return;

  const optimalId = await getOptimalId(pendingItem.tmdbId, pendingItem.mediaType);

  await fetch(`/api/lists/${listId}/items`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      username: currentUsername,
      item: {
        tmdbId: pendingItem.tmdbId,
        imdbId: optimalId,
        mediaType: pendingItem.mediaType,
        title: pendingItem.title,
        poster: pendingItem.poster,
        overview: pendingItem.overview,
        rating: pendingItem.rating
      }
    })
  });

  alert('¬°A√±adido correctamente!');
  document.getElementById('listModal').classList.remove('active');
  pendingItem = null;
  loadLists(currentUsername);
});

async function loadLists(username) {
  const res = await fetch(`/api/lists?username=${username}`);
  const lists = await res.json();
  const t = translations[currentLang] || translations.en;
  
  const display = document.getElementById('listDisplay');
  display.innerHTML = lists.length === 0 
    ? `<p style="text-align:center; opacity:0.7">${t.noLists}</p>` 
    : lists.map((list, idx) => `
      <div class="list-item" draggable="true" data-id="${list.id}" data-index="${idx}">
        <div class="list-info" onclick="showListDetail('${list.id}')">
          <strong>${escapeHtml(list.name)}</strong>
          <span style="opacity:0.8">${escapeHtml(list.type)}</span><br>
          <small>${list.items?.length || 0} elementos</small>
        </div>
        <div class="list-actions">
          <button onclick="shareList('${list.id}', '${escapeHtml(list.name)}', '${list.pin}')">${t.share}</button>
          <button onclick="deleteList('${list.id}')" ${!list.isOwner ? 'disabled style="opacity:0.3"' : ''}>${t.delete}</button>
          <div class="arrows">
            <button onclick="moveList('${list.id}', ${idx}, -1)" ${idx === 0 ? 'disabled' : ''}>‚Üë</button>
            <button onclick="moveList('${list.id}', ${idx}, 1)" ${idx === lists.length - 1 ? 'disabled' : ''}>‚Üì</button>
          </div>
        </div>
      </div>
    `).join('');

  document.querySelectorAll('.list-item').forEach(item => {
    item.addEventListener('dragstart', handleDragStart);
    item.addEventListener('dragover', handleDragOver);
    item.addEventListener('drop', handleDrop);
    item.addEventListener('dragend', handleDragEnd);
  });

  const modalListSelect = document.getElementById('modalListSelect');
  modalListSelect.innerHTML = lists.map(l => `<option value="${l.id}">${escapeHtml(l.name)}</option>`).join('');
}

async function loadFriends(username) {
  const res = await fetch(`/api/friends?username=${username}`);
  const friends = await res.json();
  const t = translations[currentLang] || translations.en;
  
  const display = document.getElementById('friendsDisplay');
  if (friends.length === 0) {
    display.innerHTML = `<p style="text-align:center; opacity:0.7">${t.noFriends}</p>`;
  } else {
    display.innerHTML = friends.map(f => `
      <div class="friend-item">
        <div class="friend-info" onclick="showFriendDetail('${escapeHtml(f.friend_username)}')">
          <strong>${escapeHtml(f.friend_username)}</strong>
        </div>
        <button onclick="removeFriend('${escapeHtml(f.friend_username)}')">${t.removeFriend}</button>
      </div>
    `).join('');
  }
}

document.getElementById('addFriendForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const friendUsername = document.getElementById('friendUsername').value.trim();
  if (!friendUsername || friendUsername === currentUsername) {
    alert('Usuario inv√°lido');
    return;
  }

  const res = await fetch('/api/friends/add', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username: currentUsername, friendUsername })
  });

  if (res.ok) {
    loadFriends(currentUsername);
    e.target.reset();
  } else {
    const data = await res.json();
    alert(data.error || 'Error al a√±adir amigo');
  }
});

async function removeFriend(friendUsername) {
  if (!confirm(`¬øEliminar a ${friendUsername}?`)) return;
  await fetch(`/api/friends/${friendUsername}?username=${currentUsername}`, { method: 'DELETE' });
  loadFriends(currentUsername);
}

async function showFriendDetail(friendUsername) {
  document.getElementById('friendDetailTitle').textContent = friendUsername;
  
  const listsRes = await fetch(`/api/lists?username=${friendUsername}`);
  const lists = await listsRes.json();
  const t = translations[currentLang] || translations.en;
  
  const listsDisplay = document.getElementById('friendListsDisplay');
  listsDisplay.innerHTML = lists.length === 0 
    ? `<p style="opacity:0.7">${t.noLists}</p>` 
    : lists.map(list => `
      <div class="list-item">
        <div class="list-info">
          <strong>${escapeHtml(list.name)}</strong>
          <span style="opacity:0.8">${escapeHtml(list.type)}</span><br>
          <small>${list.items?.length || 0} elementos</small>
        </div>
      </div>
    `).join('');

  document.getElementById('friendRatingsDisplay').innerHTML = '<p style="opacity:0.7">Pr√≥ximamente...</p>';
  document.getElementById('mainScreen').classList.remove('active');
  document.getElementById('friendDetailScreen').classList.add('active');
}

document.getElementById('backFromFriendBtn').addEventListener('click', () => {
  document.getElementById('friendDetailScreen').classList.remove('active');
  document.getElementById('mainScreen').classList.add('active');
});

function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

let draggedElement = null;

function handleDragStart(e) {
  draggedElement = this;
  this.classList.add('dragging');
  e.dataTransfer.effectAllowed = 'move';
}

function handleDragOver(e) {
  if (e.preventDefault) e.preventDefault();
  this.classList.add('drag-over');
  e.dataTransfer.dropEffect = 'move';
  return false;
}

function handleDrop(e) {
  if (e.stopPropagation) e.stopPropagation();
  if (draggedElement !== this) {
    const fromIndex = parseInt(draggedElement.dataset.index);
    const toIndex = parseInt(this.dataset.index);
    moveList(draggedElement.dataset.id, fromIndex, toIndex - fromIndex);
  }
  return false;
}

function handleDragEnd() {
  document.querySelectorAll('.list-item').forEach(item => {
    item.classList.remove('dragging', 'drag-over');
  });
}

async function shareList(id, name, pin) {
  document.getElementById('pinDisplay').textContent = pin;
  document.getElementById('showPinModal').classList.add('active');
}

document.getElementById('copyPinBtn').addEventListener('click', () => {
  const pin = document.getElementById('pinDisplay').textContent;
  navigator.clipboard.writeText(pin);
  alert('¬°PIN copiado!');
});

document.getElementById('closePinBtn').addEventListener('click', () => {
  document.getElementById('showPinModal').classList.remove('active');
});

async function deleteList(id) {
  if (!confirm('¬øEliminar esta lista?')) return;
  await fetch(`/api/lists/${id}?username=${currentUsername}`, { method: 'DELETE' });
  loadLists(currentUsername);
}

async function moveList(id, currentIndex, direction) {
  const newOrder = currentIndex + direction;
  await fetch(`/api/lists/${id}/reorder`, {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username: currentUsername, newOrder })
  });
  loadLists(currentUsername);
}

document.getElementById('importBtn').addEventListener('click', () => {
  document.getElementById('pinModal').classList.add('active');
});

document.getElementById('pinCancelBtn').addEventListener('click', () => {
  document.getElementById('pinModal').classList.remove('active');
  document.getElementById('pinInput').value = '';
});

document.getElementById('pinImportBtn').addEventListener('click', async () => {
  const pin = document.getElementById('pinInput').value.trim();
  if (pin.length !== 6) {
    alert('El PIN debe tener 6 d√≠gitos');
    return;
  }

  const res = await fetch('/api/lists/import-pin', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username: currentUsername, pin })
  });

  if (res.ok) {
    alert('¬°Lista importada correctamente!');
    document.getElementById('pinModal').classList.remove('active');
    document.getElementById('pinInput').value = '';
    loadLists(currentUsername);
  } else {
    const data = await res.json();
    alert(data.error || 'PIN no v√°lido');
  }
});

document.getElementById('copyInstallBtn').addEventListener('click', () => {
  const url = `${window.location.origin}/manifest.json?username=${currentUsername}&addonName=${encodeURIComponent(currentAddonName)}`;
  navigator.clipboard.writeText(url);
  alert('¬°URL copiada!');
});

document.getElementById('installBtn').addEventListener('click', () => {
  const url = `stremio://${window.location.host}/manifest.json?username=${currentUsername}&addonName=${encodeURIComponent(currentAddonName)}`;
  window.open(url, '_blank');
});

async function showListDetail(listId) {
  currentListId = listId;
  const res = await fetch(`/api/lists/${listId}?username=${currentUsername}`);
  const list = await res.json();
  document.getElementById('listDetailTitle').textContent = list.name;
  const t = translations[currentLang] || translations.en;
  
  const itemsContainer = document.getElementById('listDetailItems');
  itemsContainer.innerHTML = list.items.length === 0 
    ? `<p style="text-align:center; opacity:0.7">${t.noItems}</p>` 
    : list.items.map(item => `
      <div class="detail-item">
        <div class="detail-item-content">
          <img src="${item.poster ? `https://image.tmdb.org/t/p/w200${item.poster}` : `image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='120'%3E%3Crect fill='%23333' width='80' height='120'%3E%3C/svg%3E`}" alt="${escapeHtml(item.title)}">
          <div class="detail-item-info">
            <div class="detail-item-title">
              <strong>${escapeHtml(item.title)}</strong>
              ${item.rating ? `<span class="rating">${escapeHtml(item.rating)}</span>` : ''}
            </div>
            <div class="overview">${escapeHtml(item.overview || 'Sin sinopsis')}</div>
          </div>
        </div>
        <div class="detail-item-actions">
          <button onclick="openRatingModal('${item.id}')">${t.rate}</button>
          <button onclick="viewRatings('${item.id}')">${item.avgRating ? item.avgRating : t.viewRatings}</button>
          ${list.isOwner ? `<button class="delete-btn" onclick="deleteItem('${listId}', '${item.id}')">${t.deleteItem}</button>` : ''}
        </div>
      </div>
    `).join('');

  document.getElementById('mainScreen').classList.remove('active');
  document.getElementById('listDetailScreen').classList.add('active');
}

document.getElementById('backBtn').addEventListener('click', () => {
  document.getElementById('listDetailScreen').classList.remove('active');
  document.getElementById('mainScreen').classList.add('active');
  loadLists(currentUsername);
});

async function deleteItem(listId, itemId) {
  if (!confirm('¬øEliminar este elemento?')) return;
  await fetch(`/api/lists/${listId}/items/${itemId}?username=${currentUsername}`, { method: 'DELETE' });
  showListDetail(listId);
}

function openRatingModal(itemId) {
  currentItemId = itemId;
  selectedRating = 0;
  const t = translations[currentLang] || translations.en;
  
  document.getElementById('ratingModal').classList.add('active');
  
  const modalContent = document.getElementById('ratingModal').querySelector('.modal-content');
  modalContent.innerHTML = `
    <h3>${t.rateTitle}</h3>
    <div class="star-rating">
      ${[1,2,3,4,5,6,7,8,9,10].map(i => `
        <span class="star ${i <= selectedRating ? 'active' : ''}" onclick="selectRating(${i})">‚≠ê</span>
      `).join('')}
    </div>
    <div style="text-align: center; margin: 10px 0; color: #ffd700; font-size: 18px; font-weight: 600;">
      <span id="ratingDisplay">${selectedRating}/10</span>
    </div>
    <textarea id="reviewText" placeholder="${t.reviewPlaceholder}" rows="4" style="width: 100%; margin: 15px 0; padding: 10px; background: #2a2a2a; color: white; border: 1px solid #444; border-radius: 8px;"></textarea>
    <div class="modal-buttons">
      <button id="cancelRatingBtn">${t.cancel}</button>
      <button id="submitRatingBtn" ${selectedRating === 0 ? 'disabled' : ''}>${t.submit}</button>
    </div>
  `;
  
  document.getElementById('cancelRatingBtn').addEventListener('click', closeRateModal);
  document.getElementById('submitRatingBtn').addEventListener('click', submitRating);
}

function selectRating(rating) {
  selectedRating = rating;
  document.querySelectorAll('.star').forEach((star, idx) => {
    if (idx < rating) {
      star.classList.add('active');
    } else {
      star.classList.remove('active');
    }
  });
  document.getElementById('ratingDisplay').textContent = `${rating}/10`;
  document.getElementById('submitRatingBtn').disabled = false;
}

function closeRateModal() {
  document.getElementById('ratingModal').classList.remove('active');
  selectedRating = 0;
}

async function submitRating() {
  if (selectedRating === 0) {
    alert('Por favor selecciona una calificaci√≥n');
    return;
  }

  const review = document.getElementById('reviewText').value.trim();

  await fetch(`/api/items/${currentItemId}/rate`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username: currentUsername, stars: selectedRating, review })
  });

  alert('¬°Calificaci√≥n guardada!');
  document.getElementById('ratingModal').classList.remove('active');
  showListDetail(currentListId);
}

// *** FUNCIONES MODIFICADAS PARA MOSTRAR TODAS LAS CALIFICACIONES ***
async function viewRatings(itemId) {
  currentRatingsItemId = itemId;
  ratingsFilterFriendsOnly = false;
  await loadRatings(itemId);
}

async function loadRatings(itemId) {
  const t = translations[currentLang] || translations.en;
  const filterParam = ratingsFilterFriendsOnly ? '&friendsOnly=true' : '';
  
  console.log('üîç Cargando calificaciones para item:', itemId);
  console.log('üîç Usuario actual:', currentUsername);
  console.log('üîç Filtro amigos:', ratingsFilterFriendsOnly);
  console.log('üîç URL:', `/api/items/${itemId}/ratings?username=${currentUsername}${filterParam}`);
  
  const res = await fetch(`/api/items/${itemId}/ratings?username=${currentUsername}${filterParam}`);
  const ratings = await res.json();
  
  console.log('üìä Calificaciones recibidas:', ratings);
  console.log('üìä Total de calificaciones:', ratings.length);
  
  const display = document.getElementById('ratingsDisplay');
  
  if (ratings.length === 0) {
    display.innerHTML = '<p style="text-align: center; padding: 20px; opacity: 0.7;">No hay calificaciones a√∫n</p>';
  } else {
    display.innerHTML = `
      <div style="margin-bottom: 15px; text-align: right;">
        <button onclick="toggleRatingsFilter()" class="filter-btn">
          ${ratingsFilterFriendsOnly ? t.showingFriends || 'üë• Mostrando: Amigos' : t.showingAll || 'üåç Mostrando: Todos'}
        </button>
      </div>
      ${ratings.map(r => `
        <div class="rating-item" style="border-bottom: 1px solid #444; padding: 15px 0;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
            <strong style="color: #ffd700;">${escapeHtml(r.username)}</strong>
            <span style="color: #ffd700; font-size: 18px;">${'‚≠ê'.repeat(r.stars)} (${r.stars}/10)</span>
          </div>
          ${r.review ? `<p style="color: #ccc; margin: 8px 0;">${escapeHtml(r.review)}</p>` : ''}
          <small style="color: #999;">${new Date(r.created_at).toLocaleDateString()}</small>
        </div>
      `).join('')}
    `;
  }
  
  document.getElementById('viewRatingsModal').classList.add('active');
}

function toggleRatingsFilter() {
  console.log('üîÑ Alternando filtro. Antes:', ratingsFilterFriendsOnly);
  ratingsFilterFriendsOnly = !ratingsFilterFriendsOnly;
  console.log('üîÑ Despu√©s:', ratingsFilterFriendsOnly);
  loadRatings(currentRatingsItemId);
}

document.getElementById('closeRatingsBtn').addEventListener('click', () => {
  document.getElementById('viewRatingsModal').classList.remove('active');
});

let searchTimeout;
document.getElementById('searchInput').addEventListener('input', (e) => {
  clearTimeout(searchTimeout);
  const q = e.target.value.trim();
  if (q.length === 0) {
    document.getElementById('searchResults').innerHTML = '';
    return;
  }
  if (q.length < 3 || !currentTmdbKey) return;

  searchTimeout = setTimeout(async () => {
    const langMap = {
      es: 'es-ES',
      en: 'en-US',
      fr: 'fr-FR',
      de: 'de-DE',
      it: 'it-IT',
      pt: 'pt-PT',
      ru: 'ru-RU',
      ja: 'ja-JP',
      zh: 'zh-CN'
    };

    const res = await fetch(`/api/tmdb/search?q=${encodeURIComponent(q)}&key=${currentTmdbKey}&lang=${langMap[currentLang] || 'en-US'}`);
    const data = await res.json();
    const results = (data.results || [])
      .filter(item => item.media_type === 'movie' || item.media_type === 'tv')
      .sort((a, b) => (b.vote_count || 0) - (a.vote_count || 0))
      .slice(0, 12);

    document.getElementById('searchResults').innerHTML = results
      .map(item => {
        const title = item.title || item.name;
        const mediaType = item.media_type;
        const overview = item.overview || 'No hay sinopsis disponible';
        const rating = item.vote_average ? `‚≠ê ${item.vote_average.toFixed(1)}` : '';
        const poster = item.poster_path || '';
        const itemData = {
          tmdbId: item.id,
          mediaType: mediaType,
          title: title,
          poster: poster,
          overview: overview,
          rating: rating
        };
        const itemDataStr = JSON.stringify(itemData).replace(/"/g, '&quot;');
        return `
          <div class="search-item" onclick='showListModal(${itemDataStr})'>
            <img src="https://image.tmdb.org/t/p/w200${poster}" alt="${escapeHtml(title)}" onerror="this.src='image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'80\\' height=\\'120\\'%3E%3Crect fill=\\'%23333\\' width=\\'80\\' height=\\'120\\'%3E%3C/svg%3E'">
            <div class="search-item-info">
              <strong>${escapeHtml(title)}</strong>
              <small>${mediaType.toUpperCase()}</small>
              ${rating ? `<div class="rating">${rating}</div>` : ''}
              <div class="overview">${escapeHtml(overview)}</div>
            </div>
          </div>
        `;
      })
      .join('');
  }, 600);
});

window.addEventListener('DOMContentLoaded', () => {
  const savedUsername = localStorage.getItem('username');
  const savedPin = localStorage.getItem('pin');

  if (savedUsername && savedPin) {
    fetch('/api/auth/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username: savedUsername, pin: savedPin })
    })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          currentUsername = savedUsername;
          currentTmdbKey = data.user.tmdb_key;
          currentAddonName = data.user.addon_name;
          currentLang = data.user.language || 'en';
          langSelect.value = currentLang;

          const t = translations[currentLang] || translations.en;
          document.getElementById('mainTitle').textContent = t.mainTitleTemplate.replace('{{username}}', currentUsername);
          document.getElementById('welcomeScreen').classList.remove('active');
          document.getElementById('mainScreen').classList.add('active');
          loadLists(currentUsername);
          loadFriends(currentUsername);
          updateListTypePlaceholder();
          updateUI();
        }
      });
  }

  updateUI();
});
